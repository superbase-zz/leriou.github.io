<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">






<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leriou.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="君子生非异也, 善假于物也">
<meta property="og:type" content="website">
<meta property="og:title" content="Leriou's Tavern">
<meta property="og:url" content="https://leriou.github.io/page/4/index.html">
<meta property="og:site_name" content="Leriou's Tavern">
<meta property="og:description" content="君子生非异也, 善假于物也">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="哎呀是太阳嘛">
<meta property="article:tag" content="富强民主文明和谐，自由平等公正法治，爱国敬业诚信友善">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://leriou.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Leriou's Tavern</title>
  






  <style>:root {
  --body-bg-color: #f5f7f9;
  --content-bg-color: #fff;
  --card-bg-color: #f5f5f5;
  --text-color: #555;
  --blockquote-color: #666;
  --link-color: #555;
  --link-hover-color: #222;
  --brand-color: #fff;
  --brand-hover-color: #fff;
  --table-row-odd-bg-color: #f9f9f9;
  --table-row-hover-bg-color: #f5f5f5;
  --menu-item-bg-color: #f5f5f5;
  --btn-default-bg: #fff;
  --btn-default-color: #555;
  --btn-default-border-color: #555;
  --btn-default-hover-bg: #222;
  --btn-default-hover-color: #fff;
  --btn-default-hover-border-color: #222;
}
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; /* 2 */
  -webkit-appearance: textfield; /* 1 */
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; /* 2 */
  -webkit-appearance: button; /* 1 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #eee;
}
html,
body {
  height: 100%;
}
body {
  background: var(--body-bg-color);
  color: var(--text-color);
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 0.8em;
  line-height: 2;
}
@media (max-width: 991px) {
  body {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 20px 0 15px;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  border-bottom: 1px solid #999;
  color: var(--link-color);
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
  word-wrap: break-word;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  border-bottom-color: var(--link-hover-color);
  color: var(--link-hover-color);
}
iframe,
img,
video {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-image: repeating-linear-gradient(-45deg, #ddd, #ddd 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: var(--blockquote-color);
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: bold;
}
dd {
  margin: 0;
  padding: 0;
}
kbd {
  background-color: #f5f5f5;
  background-image: linear-gradient(#eee, #fff, #eee);
  border: 1px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  color: #555;
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
.table-container {
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px 0;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: var(--table-row-odd-bg-color);
}
tbody tr:hover {
  background: var(--table-row-hover-bg-color);
}
caption,
th,
td {
  font-weight: normal;
  padding: 8px;
  text-align: left;
  vertical-align: middle;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: var(--btn-default-bg);
  border: 2px solid var(--btn-default-border-color);
  border-radius: 2px;
  color: var(--btn-default-color);
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  text-decoration: none;
  transition-property: background-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.btn:hover {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: inline-block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: all 0.4s;
  vertical-align: top;
  width: 100%;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 3px;
}
.toggle.toggle-arrow .toggle-line-first {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow .toggle-line-middle {
  left: 2px;
  width: 90%;
}
.toggle.toggle-arrow .toggle-line-last {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close .toggle-line-first {
  transform: rotate(-45deg);
  top: 5px;
}
.toggle.toggle-close .toggle-line-middle {
  opacity: 0;
}
.toggle.toggle-close .toggle-line-last {
  transform: rotate(45deg);
  top: -5px;
}
.highlight-container {
  position: relative;
}
.highlight-container:hover .copy-btn,
.highlight-container .copy-btn:focus {
  opacity: 1;
}
.copy-btn {
  color: #333;
  cursor: pointer;
  line-height: 1.6;
  opacity: 0;
  padding: 2px 6px;
  position: absolute;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  color: #fff;
  font-size: 14px;
  right: 0;
  top: 2px;
}
.highlight-container {
  background: #21252b;
  border-radius: 5px;
  box-shadow: 0 10px 30px 0 rgba(0,0,0,0.4);
  padding-top: 30px;
}
.highlight-container::before {
  background: #fc625d;
  border-radius: 50%;
  box-shadow: 20px 0 #fdbc40, 40px 0 #35cd4b;
  content: ' ';
  height: 12px;
  left: 12px;
  margin-top: -20px;
  position: absolute;
  width: 12px;
}
.highlight-container .highlight {
  border-radius: 0 0 5px 5px;
}
.highlight-container .highlight .table-container {
  border-radius: 0 0 5px 5px;
}
.highlight,
pre {
  background: #f7f7f7;
  color: #4d4d4c;
  line-height: 1.6;
  margin: 0 auto 20px;
}
pre,
code {
  font-family: consolas, Menlo, monospace, "PingFang SC", "Microsoft YaHei";
}
code {
  background: #eee;
  border-radius: 3px;
  color: #555;
  padding: 2px 4px;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
.highlight *::selection {
  background: #d6d6d6;
}
.highlight pre {
  border: 0;
  margin: 0;
  padding: 10px 0;
}
.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
.highlight td {
  border: 0;
  padding: 0;
}
.highlight figcaption {
  background: #eff2f3;
  color: #4d4d4c;
  display: flex;
  font-size: 0.875em;
  justify-content: space-between;
  line-height: 1.2;
  padding: 0.5em;
}
.highlight figcaption a {
  color: #4d4d4c;
}
.highlight figcaption a:hover {
  border-bottom-color: #4d4d4c;
}
.highlight .gutter {
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
.highlight .gutter pre {
  background: #eff2f3;
  color: #869194;
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
}
.highlight .code pre {
  background: #f7f7f7;
  padding-left: 10px;
  width: 100%;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
}
pre code {
  background: none;
  color: #4d4d4c;
  font-size: 0.875em;
  padding: 0;
  text-shadow: none;
}
pre .deletion {
  background: #fdd;
}
pre .addition {
  background: #dfd;
}
pre .meta {
  color: #eab700;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
pre .comment {
  color: #8e908c;
}
pre .variable,
pre .attribute,
pre .tag,
pre .name,
pre .regexp,
pre .ruby .constant,
pre .xml .tag .title,
pre .xml .pi,
pre .xml .doctype,
pre .html .doctype,
pre .css .id,
pre .css .class,
pre .css .pseudo {
  color: #c82829;
}
pre .number,
pre .preprocessor,
pre .built_in,
pre .builtin-name,
pre .literal,
pre .params,
pre .constant,
pre .command {
  color: #f5871f;
}
pre .ruby .class .title,
pre .css .rules .attribute,
pre .string,
pre .symbol,
pre .value,
pre .inheritance,
pre .header,
pre .ruby .symbol,
pre .xml .cdata,
pre .special,
pre .formula {
  color: #718c00;
}
pre .title,
pre .css .hexcolor {
  color: #3e999f;
}
pre .function,
pre .python .decorator,
pre .python .title,
pre .ruby .function .title,
pre .ruby .title .keyword,
pre .perl .sub,
pre .javascript .title,
pre .coffeescript .title {
  color: #4271ae;
}
pre .keyword,
pre .javascript .function {
  color: #8959a8;
}
.blockquote-center {
  border-left: none;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center .fa {
  display: block;
  opacity: 0.6;
  position: absolute;
  width: 100%;
}
.blockquote-center .fa-quote-left {
  border-top: 1px solid #ccc;
  text-align: left;
  top: -20px;
}
.blockquote-center .fa-quote-right {
  border-bottom: 1px solid #ccc;
  text-align: right;
  bottom: -20px;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.post-body .group-picture img {
  margin: 0 auto;
  padding: 0 3px;
}
.group-picture-row {
  margin-bottom: 6px;
  overflow: hidden;
}
.group-picture-column {
  float: left;
  margin-bottom: 10px;
}
.post-body .label {
  color: #555;
  display: inline;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  display: block;
  padding-top: 10px;
  position: relative;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  display: flex;
  flex-wrap: wrap;
  margin: 0;
  margin-bottom: -1px;
  padding: 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
  border-radius: 0 0 0 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-radius: 0;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  outline: 0;
  padding: 0.25em 0.75em;
  text-align: center;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i,
.tabs-comment ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom: 1px solid transparent;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-top: 3px solid #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom: 1px solid #ddd;
    border-left: 3px solid #fc6423;
    border-right: 1px solid #ddd;
    border-top: 1px solid #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  color: var(--link-color);
  cursor: default;
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  border: 1px solid #ddd;
  border-top: 0;
  padding: 20px 20px 0 20px;
  border-radius: 0;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .tabs .tab-content .tab-pane.active,
.tabs-comment .tab-content .tab-pane.active {
  display: block;
}
.post-body .tabs .tab-content .tab-pane.active:nth-of-type(1),
.tabs-comment .tab-content .tab-pane.active:nth-of-type(1) {
  border-radius: 0 0 0 0;
}
@media (max-width: 413px) {
  .post-body .tabs .tab-content .tab-pane.active:nth-of-type(1),
  .tabs-comment .tab-content .tab-pane.active:nth-of-type(1) {
    border-radius: 0;
  }
}
.post-body .note {
  border-radius: 3px;
  margin-bottom: 20px;
  padding: 1em;
  position: relative;
  border: 1px solid #eee;
  border-left-width: 5px;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  margin-top: 0;
  border-bottom: initial;
  margin-bottom: 0;
  padding-top: 0;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child,
.post-body .note img:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child,
.post-body .note img:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: 0 10px;
  padding: 0 11px;
  position: relative;
  top: -1px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition-property: border-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: #222;
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.pagination .prev {
  margin-left: 0;
}
.pagination .next {
  margin-right: 0;
}
.pagination .page-number.current {
  background: #ccc;
  border-top-color: #ccc;
  color: #fff;
}
@media (max-width: 767px) {
  .pagination {
    border-top: none;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
    margin-bottom: 10px;
    padding: 0 10px;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: #222;
  }
}
.comments {
  margin-top: 60px;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  flex-wrap: wrap-reverse;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  background: var(--content-bg-color);
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  border: 0;
  box-shadow: none;
  margin-top: 0;
  padding-top: 0;
}
.container {
  min-height: 100%;
  position: relative;
}
.main-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .main-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main-inner {
    width: 73%;
  }
}
@media (max-width: 767px) {
  .content-wrap {
    padding: 0 20px;
  }
}
.header {
  background: transparent;
}
.header-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header-inner {
    width: 73%;
  }
}
.site-brand-container {
  display: flex;
  flex-shrink: 0;
  padding: 0 10px;
}
.headband {
  background: #222;
  height: 3px;
}
.site-meta {
  flex-grow: 1;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.brand {
  border-bottom: none;
  color: var(--brand-color);
  display: inline-block;
  line-height: 1.375em;
  padding: 0 40px;
  position: relative;
}
.brand:hover {
  color: var(--brand-hover-color);
}
.site-title {
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  margin: 0;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin: 10px 0;
}
.use-motion .brand {
  opacity: 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle,
.site-nav-right {
  display: none;
}
@media (max-width: 767px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: var(--text-color);
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: var(--text-color);
  border-radius: 1px;
}
.site-nav {
  display: block;
}
@media (max-width: 767px) {
  .site-nav {
    clear: both;
    display: none;
  }
}
.site-nav.site-nav-on {
  display: block;
}
.menu {
  margin-top: 20px;
  padding-left: 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    display: block;
    margin-top: 10px;
  }
  .menu-item.menu-item-search {
    display: none;
  }
}
.menu-item a,
.menu-item span.exturl {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition-property: border-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
@media (hover: none) {
  .menu-item a:hover,
  .menu-item span.exturl:hover {
    border-bottom-color: transparent !important;
  }
}
.menu-item .fa,
.menu-item .fab,
.menu-item .far,
.menu-item .fas {
  margin-right: 8px;
}
.menu-item .badge {
  display: inline-block;
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  margin-top: 0.35em;
  text-align: center;
  white-space: nowrap;
}
@media (max-width: 767px) {
  .menu-item .badge {
    float: right;
    margin-left: 0;
  }
}
.menu-item-active a,
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  background: var(--menu-item-bg-color);
}
.use-motion .menu-item {
  opacity: 0;
}
.sidebar {
  background: #222;
  bottom: 0;
  box-shadow: inset 0 2px 6px #000;
  position: fixed;
  top: 0;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-inner {
  color: #999;
  padding: 18px 10px;
  text-align: center;
}
.cc-license {
  margin-top: 10px;
  text-align: center;
}
.cc-license .cc-opacity {
  border-bottom: none;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.site-author-image {
  border: 1px solid #eee;
  display: block;
  margin: 0 auto;
  max-width: 120px;
  padding: 2px;
}
.site-author-name {
  color: var(--text-color);
  font-weight: 600;
  margin: 0;
  text-align: center;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
  text-align: center;
}
.links-of-author {
  margin-top: 15px;
}
.links-of-author a,
.links-of-author span.exturl {
  border-bottom-color: #555;
  display: inline-block;
  font-size: 0.8125em;
  margin-bottom: 10px;
  margin-right: 10px;
  vertical-align: middle;
}
.links-of-author a::before,
.links-of-author span.exturl::before {
  background: #ff8538;
  border-radius: 50%;
  content: ' ';
  display: inline-block;
  height: 4px;
  margin-right: 3px;
  vertical-align: middle;
  width: 4px;
}
.sidebar-button {
  margin-top: 15px;
}
.sidebar-button a {
  border: 1px solid #fc6423;
  border-radius: 4px;
  color: #fc6423;
  display: inline-block;
  padding: 0 15px;
}
.sidebar-button a .fa,
.sidebar-button a .fab,
.sidebar-button a .far,
.sidebar-button a .fas {
  margin-right: 5px;
}
.sidebar-button a:hover {
  background: #fc6423;
  border: 1px solid #fc6423;
  color: #fff;
}
.sidebar-button a:hover .fa,
.sidebar-button a:hover .fab,
.sidebar-button a:hover .far,
.sidebar-button a:hover .fas {
  color: #fff;
}
.links-of-blogroll {
  font-size: 0.8125em;
  margin-top: 10px;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
  margin-top: 0;
}
.links-of-blogroll-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
#sidebar-dimmer {
  display: none;
}
@media (max-width: 767px) {
  #sidebar-dimmer {
    background: #000;
    display: block;
    height: 100%;
    left: 100%;
    opacity: 0;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1100;
  }
  .sidebar-active + #sidebar-dimmer {
    opacity: 0.7;
    transform: translateX(-100%);
    transition: opacity 0.5s;
  }
}
.sidebar-nav {
  margin: 0;
  padding-bottom: 20px;
  padding-left: 0;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: var(--text-color);
  cursor: pointer;
  display: inline-block;
  font-size: 0.875em;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-nav .sidebar-nav-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sidebar-nav .sidebar-nav-active:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
  overflow-x: hidden;
  overflow-y: auto;
}
.sidebar-panel-active {
  display: block;
}
.sidebar-toggle {
  background: #222;
  bottom: 45px;
  cursor: pointer;
  height: 14px;
  left: 30px;
  padding: 5px;
  position: fixed;
  width: 14px;
  z-index: 1300;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    left: 20px;
    opacity: 0.8;
    display: none;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition-property: all;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-state {
  display: flex;
  justify-content: center;
  line-height: 1.4;
  margin-top: 10px;
  overflow: hidden;
  text-align: center;
  white-space: nowrap;
}
.site-state-item {
  padding: 0 15px;
}
.site-state-item:not(:first-child) {
  border-left: 1px solid #eee;
}
.site-state-item a {
  border-bottom: none;
}
.site-state-item-count {
  display: block;
  font-size: 1em;
  font-weight: 600;
  text-align: center;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer-inner {
  box-sizing: border-box;
  margin: 0 auto;
  text-align: center;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.languages {
  display: inline-block;
  font-size: 1.125em;
  position: relative;
}
.languages .lang-select-label span {
  margin: 0 0.5em;
}
.languages .lang-select {
  height: 100%;
  left: 0;
  opacity: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.with-love {
  color: #ff0000;
  display: inline-block;
  margin: 0 5px;
}
.powered-by,
.theme-info {
  display: inline-block;
}
@-moz-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  font-size: 12px;
  text-align: center;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.back-to-top {
  background: #222;
  bottom: -100px;
  box-sizing: border-box;
  color: #fff;
  cursor: pointer;
  left: 30px;
  opacity: 0.6;
  padding: 0 6px;
  position: fixed;
  transition-property: bottom;
  z-index: 1300;
  width: 24px;
}
.back-to-top span {
  display: none;
}
.back-to-top:hover {
  color: #fc6423;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
@media (max-width: 991px) {
  .back-to-top {
    left: 20px;
    opacity: 0.8;
  }
}
.post-body {
  font-family: 'Lato', 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
.post-body .exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body .image-caption,
.post-body .figure .caption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -20px auto 15px;
  text-align: center;
}
.post-sticky-flag {
  display: inline-block;
  transform: rotate(30deg);
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  opacity: 0;
}
.use-motion .post-header {
  opacity: 0;
}
.use-motion .post-body {
  opacity: 0;
}
.use-motion .collection-header {
  opacity: 0;
}
.posts-collapse {
  margin-left: 35px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin-left: 0px;
    margin-right: 0px;
  }
}
.posts-collapse .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  left: 0;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  width: 10px;
}
.posts-collapse .collection-year {
  font-size: 1.5em;
  font-weight: bold;
  margin: 60px 0;
  position: relative;
}
.posts-collapse .collection-year::before {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  left: 0;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  width: 8px;
}
.posts-collapse .collection-header {
  display: block;
  margin: 0 0 0 20px;
}
.posts-collapse .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 0;
  padding-left: 15px;
  position: relative;
  transition-property: border;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-collapse .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  left: 0;
  margin-left: -4px;
  position: absolute;
  top: 0.75em;
  transition-property: background;
  width: 6px;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-collapse .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-meta {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-title {
  display: inline;
}
.posts-collapse .post-title a,
.posts-collapse .post-title span.exturl {
  border-bottom: none;
  color: var(--link-color);
}
.posts-collapse .post-title .fa-external-link-alt {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-collapse::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  left: 0;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  text-align: center;
  width: 8%;
}
.post-block:last-of-type .post-eof {
  display: none;
}
.content {
  padding-top: 40px;
}
@media (min-width: 992px) {
  .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: justify;
  }
}
.post-body h1,
.post-body h2,
.post-body h3,
.post-body h4,
.post-body h5,
.post-body h6 {
  padding-top: 10px;
}
.post-body h1 .header-anchor,
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor {
  border-bottom-style: none;
  color: #ccc;
  float: right;
  margin-left: 10px;
  visibility: hidden;
}
.post-body h1 .header-anchor:hover,
.post-body h2 .header-anchor:hover,
.post-body h3 .header-anchor:hover,
.post-body h4 .header-anchor:hover,
.post-body h5 .header-anchor:hover,
.post-body h6 .header-anchor:hover {
  color: inherit;
}
.post-body h1:hover .header-anchor,
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor {
  visibility: visible;
}
.post-body iframe,
.post-body img,
.post-body video {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  align-items: center;
  display: grid;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr 1fr;
  margin-bottom: 20px;
}
@media (max-width: 767px) {
  .post-gallery {
    grid-template-columns: 1fr 1fr;
  }
}
.post-gallery a {
  border: 0;
}
.post-gallery img {
  margin: 0;
}
.posts-expand .post-header {
  font-size: 1.125em;
}
.posts-expand .post-title {
  font-size: 1.5em;
  font-weight: normal;
  margin: initial;
  text-align: center;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: none;
  color: var(--link-color);
  display: inline-block;
  position: relative;
  vertical-align: top;
}
.posts-expand .post-title-link::before {
  background: var(--link-color);
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  visibility: hidden;
  width: 100%;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
  visibility: visible;
}
.posts-expand .post-title-link .fa-external-link-alt {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-expand .post-meta {
  color: #999;
  font-family: 'Lato', 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 0.75em;
  margin: 3px 0 60px 0;
  text-align: center;
}
.posts-expand .post-meta .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta time {
  border-bottom: 1px dashed #999;
  cursor: pointer;
}
.post-meta .post-meta-item + .post-meta-item::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-divider {
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-nav {
  border-top: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  margin-top: 15px;
  padding: 10px 5px 0;
}
.post-nav-item {
  flex: 1;
}
.post-nav-item a {
  border-bottom: none;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
  position: relative;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
}
.post-nav-item:first-child {
  margin-right: 15px;
}
.post-nav-item:first-child .fa {
  margin-right: 5px;
}
.post-nav-item:last-child {
  margin-left: 15px;
  text-align: right;
}
.post-nav-item:last-child .fa {
  margin-left: 5px;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.post-widgets {
  border-top: 1px solid #eee;
  margin-top: 15px;
  text-align: center;
}
.wp_rating {
  height: 20px;
  line-height: 20px;
  margin-top: 10px;
  padding-top: 6px;
  text-align: center;
}
.social-like {
  display: flex;
  font-size: 0.875em;
  justify-content: center;
  text-align: center;
}
.reward-container {
  margin: 20px auto;
  padding: 10px 0;
  text-align: center;
  width: 90%;
}
.reward-container button {
  background: #ff2a2a;
  border: 0;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
  line-height: 2;
  outline: 0;
  padding: 0 15px;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #f55;
}
#qr {
  padding-top: 20px;
}
#qr a {
  border: 0;
}
#qr img {
  display: inline-block;
  margin: 0.8em 2em 0 2em;
  max-width: 100%;
  width: 180px;
}
#qr p {
  text-align: center;
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count::before {
  content: ' (';
  display: inline;
}
.category-all-page .category-list-count::after {
  content: ') ';
  display: inline;
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list {
  padding: 0;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px 0;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
  text-align: right;
}
.event-list .event {
  background: #222;
  margin: 20px 0;
  min-height: 40px;
  padding: 15px 0 15px 10px;
}
.event-list .event .event-summary {
  color: #fff;
  margin: 0;
  padding-bottom: 3px;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  color: #fff;
  content: '\f111';
  display: inline-block;
  font-size: 10px;
  margin-right: 25px;
  vertical-align: middle;
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.event-list .event .event-relative-time {
  color: #bbb;
  display: inline-block;
  font-size: 12px;
  font-weight: normal;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: #fff;
  display: block;
  line-height: 18px;
  margin-left: 56px;
  padding-bottom: 6px;
  padding-top: 3px;
  text-indent: -24px;
}
.event-list .event .event-details::before {
  color: #fff;
  display: inline-block;
  margin-right: 9px;
  text-align: center;
  text-indent: 0;
  width: 14px;
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event-past {
  background: #f5f5f5;
}
.event-list .event-past .event-summary,
.event-list .event-past .event-details {
  color: #bbb;
  opacity: 0.9;
}
.event-list .event-past .event-summary::before,
.event-list .event-past .event-details::before {
  animation: none;
  color: #bbb;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li + li::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li + li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud a:hover {
  color: var(--link-hover-color) !important;
}
.search-pop-overlay {
  background: rgba(0,0,0,0);
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  transition: visibility 0s linear 0.2s, background 0.2s;
  visibility: hidden;
  width: 100%;
  z-index: 1400;
}
.search-pop-overlay.search-active {
  background: rgba(0,0,0,0.3);
  transition: background 0.2s;
  visibility: visible;
}
.search-popup {
  background: var(--card-bg-color);
  border-radius: 5px;
  height: 80%;
  left: calc(50% - 350px);
  position: fixed;
  top: 10%;
  transform: scale(0);
  transition: transform 0.2s;
  width: 700px;
  z-index: 1500;
}
.search-active .search-popup {
  transform: scale(1);
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    left: 0;
    margin: 0;
    top: 0;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  font-size: 18px;
  padding: 0 10px;
}
.search-popup .popup-btn-close {
  cursor: pointer;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #eee;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  display: flex;
  padding: 5px;
}
.search-popup input.search-input {
  background: transparent;
  border: 0;
  outline: 0;
  width: 100%;
}
.search-popup input.search-input::-webkit-search-cancel-button {
  display: none;
}
.search-popup .search-input-container {
  flex-grow: 1;
  padding: 2px;
}
.search-popup ul.search-result-list {
  margin: 0 5px;
  padding: 0;
  width: 100%;
}
.search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.search-popup a.search-result-title {
  font-weight: bold;
}
.search-popup .search-keyword {
  border-bottom: 1px dashed #ff2a2a;
  color: #ff2a2a;
  font-weight: bold;
}
.search-popup #search-result {
  display: flex;
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 25px;
}
.search-popup #no-result {
  color: #ccc;
  margin: auto;
}
.header {
  margin: 0 auto;
  position: relative;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .header {
    width: auto;
  }
}
.header-inner {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  overflow: hidden;
  padding: 0;
  position: absolute;
  top: 0;
  width: 240px;
}
@media (min-width: 1200px) {
  .header-inner {
    width: 240px;
  }
}
@media (max-width: 991px) {
  .header-inner {
    border-radius: initial;
    position: relative;
    width: auto;
  }
}
.main-inner {
  align-items: flex-start;
  display: flex;
  justify-content: space-between;
  flex-direction: row-reverse;
}
@media (max-width: 991px) {
  .main-inner {
    width: auto;
  }
}
.content-wrap {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  box-sizing: border-box;
  padding: 40px;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .content-wrap {
    border-radius: initial;
    padding: 20px;
    width: 100%;
  }
}
.footer-inner {
  padding-left: 260px;
}
.back-to-top {
  left: auto;
  right: 30px;
}
@media (max-width: 991px) {
  .back-to-top {
    right: 20px;
  }
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.site-brand-container {
  background: #222;
}
@media (max-width: 991px) {
  .site-brand-container {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.site-meta {
  padding: 20px 0;
}
.brand {
  padding: 0;
}
.site-subtitle {
  margin: 10px 10px 0;
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: #fff;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: #fff;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none;
  }
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  padding: 5px 20px;
  position: relative;
  text-align: left;
  transition-property: background-color;
}
@media (max-width: 991px) {
  .menu .menu-item.menu-item-search {
    display: none;
  }
}
.menu .menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: #fff;
  float: right;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
  vertical-align: middle;
}
.main-menu .menu-item-active a::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
.sub-menu {
  background: var(--content-bg-color);
  border-bottom: 1px solid #ddd;
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  background: transparent;
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: transparent;
  color: #fc6423;
}
.sub-menu .menu-item-active a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active a:hover {
  border-bottom-color: #fc6423;
}
.sidebar {
  background: var(--body-bg-color);
  box-shadow: none;
  margin-top: 100%;
  position: static;
  width: 240px;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.sidebar-inner {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  box-sizing: border-box;
  color: var(--text-color);
  width: 240px;
  opacity: 0;
}
.sidebar-inner.affix {
  position: fixed;
  top: 12px;
}
.sidebar-inner.affix-bottom {
  position: absolute;
}
.site-state-item {
  padding: 0 10px;
}
.sidebar-button {
  border-bottom: 1px dotted #ccc;
  border-top: 1px dotted #ccc;
  margin-top: 10px;
  text-align: center;
}
.sidebar-button a {
  border: 0;
  color: #fc6423;
  display: block;
}
.sidebar-button a:hover {
  background: none;
  border: 0;
  color: #e34603;
}
.sidebar-button a:hover .fa,
.sidebar-button a:hover .fab,
.sidebar-button a:hover .far,
.sidebar-button a:hover .fas {
  color: #e34603;
}
.links-of-author {
  display: flex;
  flex-wrap: wrap;
  margin-top: 10px;
  justify-content: center;
}
.links-of-author-item {
  margin: 5px 0 0;
  width: 50%;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  margin-bottom: 0;
  margin-right: 0;
  max-width: 216px;
  overflow: hidden;
  padding: 0 5px;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  display: block;
  text-decoration: none;
}
.links-of-author-item a::before,
.links-of-author-item span.exturl::before {
  display: none;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  background: var(--body-bg-color);
  border-radius: 4px;
}
.links-of-author-item .fa,
.links-of-author-item .fab,
.links-of-author-item .far,
.links-of-author-item .fas {
  margin-right: 2px;
}
.links-of-blogroll-item {
  padding: 0;
}
.post-body .link-grid {
  display: grid;
  grid-gap: 1.5rem 1.5rem;
  grid-template-columns: 1fr 1fr;
  padding: 1.5rem;
  user-select: none;
}
@media (max-width: 767px) {
  .post-body .link-grid {
    grid-template-columns: 1fr;
  }
}
.post-body .link-grid div {
  border: solid #ddd;
  box-shadow: 1rem 1rem 0.5rem #808080;
  height: 5rem;
  transition: background 0.3s;
  padding: 0.5rem;
  position: relative;
}
.post-body .link-grid div:hover {
  animation: shake 0.5s;
  background: rgba(230,244,250,0.5);
}
.post-body .link-grid div:active {
  box-shadow: 0.5rem 0.5rem 0.25rem #808080;
  transform: translate(0.2rem, 0.2rem);
}
.post-body .link-grid div img {
  border: 1px solid #ddd;
  border-radius: 50%;
  box-sizing: border-box;
  height: 5rem;
  left: 0.5rem;
  padding: 3px;
  position: absolute;
  top: 0.5rem;
  width: 5rem;
}
.post-body .link-grid div p {
  margin: 0 1rem 0 6rem;
}
.post-body .link-grid div p:first-of-type {
  font-size: 1.2em;
}
.post-body .link-grid div p:last-of-type {
  font-size: 0.8em;
  line-height: 1.3rem;
  opacity: 0.7;
}
.post-body .link-grid div a {
  border: none;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
@-moz-keyframes shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@-webkit-keyframes shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@-o-keyframes shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@keyframes shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
</style><noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Leriou's Tavern</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">我可能就是在扯淡 ^_^!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2017-01-01-comic-book-2017/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017-01-01-comic-book-2017/" class="post-title-link" itemprop="url">2017-追番-看书记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2017-01-01T00:00:00+08:00">2017-01-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">生活记录</span></a>
                </span>
            </span>

          
            <span id="/2017-01-01-comic-book-2017/" class="post-meta-item leancloud_visitors" data-flag-title="2017-追番-看书记录" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2017-01-01-comic-book-2017/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017-01-01-comic-book-2017/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h1><p>想法来自 <a href="http://blog.sollrei.me" target="_blank" rel="noopener">@Sollrei</a></p>
<h2 id="2017"><a href="#2017" class="headerlink" title="2017"></a>2017</h2><h3 id="2月"><a href="#2月" class="headerlink" title="2月"></a>2月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 东皇战影</li>
</ul>
<p>图书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 三体3:死神永生</li>
<li><input checked="" disabled="" type="checkbox"> 魔鬼搭讪学</li>
<li><input checked="" disabled="" type="checkbox"> 魔鬼约会学</li>
<li><input checked="" disabled="" type="checkbox"> 谁动了我的奶酪</li>
</ul>
<p>电影:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 假如爱有天意</li>
</ul>
<h3 id="3月"><a href="#3月" class="headerlink" title="3月"></a>3月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 人渣的本愿</li>
<li><input checked="" disabled="" type="checkbox"> 从前有座灵剑山</li>
<li><input checked="" disabled="" type="checkbox"> 斗破苍穹</li>
<li><input checked="" disabled="" type="checkbox"> 小林家的龙女仆</li>
</ul>
<p>图书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 解忧杂货铺</li>
<li><input checked="" disabled="" type="checkbox"> 嫌疑人X的献身</li>
<li><input checked="" disabled="" type="checkbox"> 图解博弈论</li>
<li><input checked="" disabled="" type="checkbox"> 菊与刀</li>
<li><input checked="" disabled="" type="checkbox"> 极简生活:简而美的活着</li>
</ul>
<h3 id="4月"><a href="#4月" class="headerlink" title="4月"></a>4月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 画江湖之不良人</li>
</ul>
<p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 人类简史</li>
<li><input checked="" disabled="" type="checkbox"> 人民的名义</li>
<li><input checked="" disabled="" type="checkbox"> 好好说话</li>
</ul>
<p>其他:</p>
<ul>
<li><input disabled="" type="checkbox"> nice chord</li>
</ul>
<h3 id="5月"><a href="#5月" class="headerlink" title="5月"></a>5月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 龙的牙医</li>
<li><input checked="" disabled="" type="checkbox"> 少年锦衣卫</li>
</ul>
<p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 走进搜索引擎</li>
<li><input checked="" disabled="" type="checkbox"> 万历十五年</li>
<li><input checked="" disabled="" type="checkbox"> 秘密</li>
<li><input checked="" disabled="" type="checkbox"> 精进:如何做一个厉害的人</li>
<li><input checked="" disabled="" type="checkbox"> Go Web编程</li>
</ul>
<h3 id="6月"><a href="#6月" class="headerlink" title="6月"></a>6月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 进击的巨人第二季</li>
</ul>
<p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> redis设计与实现</li>
</ul>
<h3 id="7月"><a href="#7月" class="headerlink" title="7月"></a>7月</h3><p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 枪炮,病菌与钢铁</li>
</ul>
<h3 id="8月"><a href="#8月" class="headerlink" title="8月"></a>8月</h3><p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 时间的形状</li>
<li><input checked="" disabled="" type="checkbox"> C++面向对象程序设计</li>
<li><input checked="" disabled="" type="checkbox"> 恶意</li>
<li><input checked="" disabled="" type="checkbox"> HTTP权威指南</li>
</ul>
<h3 id="9月"><a href="#9月" class="headerlink" title="9月"></a>9月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> FATE/Apocrypha</li>
<li><input checked="" disabled="" type="checkbox"> 画江湖之杯莫停</li>
</ul>
<p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 人生的智慧</li>
</ul>
<h3 id="10月"><a href="#10月" class="headerlink" title="10月"></a>10月</h3><p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 红楼梦(前80回原版,后四十回不符原意,不看了)</li>
<li><input checked="" disabled="" type="checkbox"> 请停止无效努力:如何用正确的方法快速进阶</li>
</ul>
<h3 id="11月"><a href="#11月" class="headerlink" title="11月"></a>11月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 魆妖纪</li>
</ul>
<p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Go语言编程</li>
<li><input checked="" disabled="" type="checkbox"> 好好说话</li>
<li><input checked="" disabled="" type="checkbox"> redis实战</li>
</ul>
<h3 id="12月"><a href="#12月" class="headerlink" title="12月"></a>12月</h3><p>番剧:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 宝石之国</li>
</ul>
<p>书:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 你要做的,只不过是发现生活的美</li>
<li><input checked="" disabled="" type="checkbox"> Java从初学到精通</li>
<li><input checked="" disabled="" type="checkbox"> 数据结构与算法</li>
<li><input checked="" disabled="" type="checkbox"> 乌合之众:大众心理研究</li>
<li><input checked="" disabled="" type="checkbox"> 精灵宝钻</li>
</ul>
<p>合计:</p>
<p>图书: 33本<br>番剧: 13部</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2016-07-07-poem-jianyingfogu/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016-07-07-poem-jianyingfogu/" class="post-title-link" itemprop="url">谏迎佛骨表--韩愈</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-07 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-07T00:00:00+08:00">2016-07-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%87%E5%8C%96%E8%89%BA%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">文化艺术</span></a>
                </span>
            </span>

          
            <span id="/2016-07-07-poem-jianyingfogu/" class="post-meta-item leancloud_visitors" data-flag-title="谏迎佛骨表--韩愈" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016-07-07-poem-jianyingfogu/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016-07-07-poem-jianyingfogu/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          唐代的一次佛儒冲突事件,看当今绿化大势有感
          <!--noindex-->
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2016-06-08-idea-programing-language/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016-06-08-idea-programing-language/" class="post-title-link" itemprop="url">关于编程语言的一些看法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-08 00:00:00" itemprop="dateCreated datePublished" datetime="2016-06-08T00:00:00+08:00">2016-06-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2016-06-08-idea-programing-language/" class="post-meta-item leancloud_visitors" data-flag-title="关于编程语言的一些看法" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016-06-08-idea-programing-language/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016-06-08-idea-programing-language/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我希望通过描述我自己对各种编程语言的看法，能帮助到对编程有兴趣的或者是刚工作不久的同学选择适合自己的编程语言。</p>
<h2 id="我对各种编程语言的看法"><a href="#我对各种编程语言的看法" class="headerlink" title="我对各种编程语言的看法"></a>我对各种编程语言的看法</h2><p>很多语言都是在特定时期，在特定领域，为了解决特定问题而出现的。所以如果我们能了解各种编程语言的特性和出现的原因，选择语言就没有那么困难。</p>
<p>先看一个Tiobe编程语言的流行趋势</p>
<p><img data-src="https://i.loli.net/2020/05/09/NfK3Vc9jqiHy7OE.png" alt="20181108-11394.png"></p>
<p>我简单列举一下我熟悉的上面出现的几个语言的优缺点</p>
<ul>
<li>c/c++</li>
</ul>
<p>优点 -&gt; 性能强，资源占用低，足够底层，满足你对代码的精确控制能力</p>
<p>缺点 -&gt; 开发效率太低了，像c语言本身标准库带有的函数太少，c++的stl倒是工具比较多，但是包管理工具什么的还是没有比较标准的。其实项目中工程构建方面的成本往往要超过语言本身带来的成本。</p>
<p>建议 -&gt; 嵌入式，操作系统，数据库等领域的开发者，普通开发者拿来做算法研究还是比较合适的，不建议个人用此类语言来做私人项目。不过还是建议个人能拥有该语言的代码阅读能力， 便于精研技术。</p>
<ul>
<li>Rust</li>
</ul>
<p>优点 -&gt; rust某种程度上正好补足了c/c++的部分不足，比如标准库比较丰富，内存安全，性能没有太多损失，包管理和工具链还比较现代化。</p>
<p>缺点 -&gt; 上手门槛高，语言限制太多，不统一，unsafe下面的rust失去了诸多优点</p>
<p>建议 -&gt; 部分原来的c++的领域很适合用rust重构，包括数据库和存储系统，消息中间件，操作系统等。而且对底层原理有兴趣的其他开发者也可以借助完善的工具链来构建个人项目，如果你想做一个偏低层的项目的话。</p>
<ul>
<li>Java</li>
</ul>
<p>优点 -&gt; 工程化好，生态强大。适合企业</p>
<p>缺点 -&gt; 太中庸了，啥都能干，干啥都不够有优势</p>
<p>建议 -&gt; 企业项目，个人做算法研究。</p>
<ul>
<li>Go</li>
</ul>
<p>优点 -&gt; 并发处理简单，工程化方便</p>
<p>缺点 -&gt; 简约到有点简陋， 语言本身缺少太多东西</p>
<p>建议 -&gt; 原PHP/Java开发者， 企业项目。同样适合个人做项目使用。</p>
<ul>
<li>Python</li>
</ul>
<p>优点 -&gt; 简单，开发效率高。</p>
<p>缺点 -&gt; 不适合企业拿来做生产项目</p>
<p>建议 -&gt; 适合编程初学者。快速搭建项目demo。</p>
<ul>
<li>Scala</li>
</ul>
<p>优点 -&gt; 表达能力强，函数式 + 面向对象</p>
<p>缺点 -&gt; 受JVM限制做了很多妥协，想深入太过复杂，成也JVM，败也JVM</p>
<p>建议 -&gt; 数据分析和处理工作者。也适合作为伪代码想别人描述算法思路</p>
<ul>
<li>scheme</li>
</ul>
<p>建议 -&gt; 对函数式编程和编程语言设计有兴趣的人，适合用来学习</p>
<ul>
<li>PHP</li>
</ul>
<p>建议 -&gt; 适合用来做与用户交互的web页面工作</p>
<ul>
<li>javascript</li>
</ul>
<p>建议 -&gt; 非前端工作者也建议学习一下， 语法简单，用途广泛</p>
<h3 id="编程语言的江湖和流派"><a href="#编程语言的江湖和流派" class="headerlink" title="编程语言的江湖和流派"></a>编程语言的江湖和流派</h3><p>c/c++/Java这种就是传统的武林豪门少林/武当这种，或许这些门派不是最强的，但一定是不会太差，处于平均水准以上。</p>
<p>虽然《九阴真经》,《北冥神功》这种级别的绝世武功也大多不是出于少林武当，但是,这种绝世武功不是适合所有人的，高收益往往伴随着高风险。所以还是建议大家多看,多学,增广见闻，见的多了,看得多了,了解的多了,最后根据自己的需要去选择,不要一开始就去选择拒绝</p>
<blockquote>
<p>当你拒绝一个事物,你就失去了向他学习的机会</p>
</blockquote>
<h2 id="一些建议"><a href="#一些建议" class="headerlink" title="一些建议"></a>一些建议</h2><p>首先建议大家初期尽量不要选择小众的冷门的编程语言。等以后有比较丰富的经验和认知以后在根据自己的需求去选择小众的语言。</p>
<p>同时我自己是建议编程初学者最好学习两个语言， 一个编译型 + 一个脚本型。这样子可以兼具功能性和便捷性。</p>
<p>初学者建议  go / java（编译型） + python / js（脚本型） 这样的搭配</p>
<p>我个人大概是这样的学习路线:</p>
<p>学校时期: C++, Java , PHP, JS, 都是学校时期学的, 当时就懂了个基本概念, 啥都没学会 。   刚工作时: C, js, PHP 早期工作需要 。<br>工作2年以后由因为工作关系接触到了Python， Go，Java，Scala。再后来希望对编程语言有更深入的认识，于是学习了Scheme和Rust。未来的花我可能会花更多时间在Rust和Scala上面</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2016-06-01-threejs-demo/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016-06-01-threejs-demo/" class="post-title-link" itemprop="url">The First Three.js Project</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-01 18:51:00" itemprop="dateCreated datePublished" datetime="2016-06-01T18:51:00+08:00">2016-06-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2016-06-01-threejs-demo/" class="post-meta-item leancloud_visitors" data-flag-title="The First Three.js Project" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016-06-01-threejs-demo/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016-06-01-threejs-demo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          这里是一些简单的three.js原理说明和演示.
          <!--noindex-->
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2016-05-12-The-Chrysanthemum-and-the-Sword/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016-05-12-The-Chrysanthemum-and-the-Sword/" class="post-title-link" itemprop="url">菊与刀</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-05-12 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-12T00:00:00+08:00">2016-05-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">阅读记录</span></a>
                </span>
            </span>

          
            <span id="/2016-05-12-The-Chrysanthemum-and-the-Sword/" class="post-meta-item leancloud_visitors" data-flag-title="菊与刀" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016-05-12-The-Chrysanthemum-and-the-Sword/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016-05-12-The-Chrysanthemum-and-the-Sword/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="记"><a href="#记" class="headerlink" title="记"></a>记</h1><p>看&lt;&lt;菊与刀&gt;&gt;的时候,我总有一种感觉, 书中所谓的对美国人来说日本人一些不能理解的地方,到底哪里不能理解了,难道不应该是这样的吗?</p>
<ol>
<li>崇尚等级与秩序,不同等级享受不同的权利,承担对应的义务</li>
<li>崇尚统一与纯粹,排斥多元化的世界和文化</li>
<li>有恩报恩,有仇报仇</li>
<li>忠,孝为先</li>
<li>自己怎么样受苦都行,但是不应该给别人添麻烦</li>
<li>自尊,自立,自强</li>
<li>相信丛林法则,弱肉强食</li>
</ol>
<h2 id="念"><a href="#念" class="headerlink" title="念"></a>念</h2><p>后来,再度回想起来,应该是我被日本文化影响太深了,所以没有发觉其中的不合理之处</p>
<p>但是,究竟是从什么时候开始的呢,从什么时候开始受到这种影响的呢?</p>
<h2 id="思"><a href="#思" class="headerlink" title="思"></a>思</h2><p>仔细分析,感觉应该是从小学就开始了</p>
<p>小学时期,与家里联系还算紧密,但是当时受动漫影响,已经开始受到日本文化影响了,只是当时这种影响还没有显现出来</p>
<ol>
<li><p>初中以后,与家里缺少联系和沟通,学习和受教育途径主要通过学校,社会和网络</p>
</li>
<li><p>本人比较聪明,接受新东西比较快,小的时候就能敏感的感受到日本动漫和电影电视所传达的价值观</p>
</li>
<li><p>受传统思想影响,比较排斥美国那种文化,所以初中以后接触的国外的文化作品,以日本的居多</p>
</li>
</ol>
<p>以上几点可能就是我形成现在这种性格和价值观的原因,但是,现在问题是要怎么改呢?</p>
<p>多看书?多分析?</p>
<h2 id="为"><a href="#为" class="headerlink" title="为"></a>为</h2><ol>
<li>多读书, 尝试接受多元的文化和观念</li>
<li>多做,多体验,多想,多比较</li>
</ol>
<h2 id="の"><a href="#の" class="headerlink" title="の"></a>の</h2><p>现在发现这个世界的本质就是<code>混乱</code>,<code>无序</code>. 强行去求得统一和规范很多时候是一种偏执</p>
<p>偏执太过就入魔了</p>
<p>世事本就如此,有些人坚持就被认为是偏执,有些人坚持就认为是有毅力,这种两面解释我接受</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2016-03-03-calculate-pi/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016-03-03-calculate-pi/" class="post-title-link" itemprop="url">如何计算圆周率π和自然常数e</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-03 00:00:00" itemprop="dateCreated datePublished" datetime="2016-03-03T00:00:00+08:00">2016-03-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
            </span>

          
            <span id="/2016-03-03-calculate-pi/" class="post-meta-item leancloud_visitors" data-flag-title="如何计算圆周率π和自然常数e" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <script crossorigin="anonymous" integrity="sha384-P75AfVrDnfsoUfx7dDfQM9ivlDhxgE+g4kqO/U7lyXtJwJdpZozbt8L5ywD2PDA0" src="https://lib.baomitu.com/vue/2.5.21/vue.min.js"></script>

<h1 id="如何计算π和e的值"><a href="#如何计算π和e的值" class="headerlink" title="如何计算π和e的值"></a>如何计算π和e的值</h1><p>从小学就知道 <code>π= 3.14159265358979...</code></p>
<p>但是一直不知道如何计算这个值</p>
<p>之前听说过祖冲之使用的是割圆法，但是我不会(T_T，流下了没有技术的泪水)</p>
<p>后来偶尔看到数学上有一种方法</p>
<p><code>π = 4 * (1 - 1/3 + 1/5 -1/7 + 1/9 ... + 1/n)</code></p>
<p>使用这种方法只要n足够大, 精度就能提高, 所以我就想用程序来尝试计算一下pi的值, 毕竟计算机比人做这种事情合适的多</p>
<p>从小学就知道 <code>π= 3.14159265358979...</code><br>后来又想到可以采用蒙特卡洛采样的方法也可以计算出来 π </p>
<p>计算方法如下, 我们随机生成 m 个 二维坐标(x, y), 并且满足  0 &lt;= x &lt; 1, 0 &lt;= y &lt; 1。然后使用欧拉距离统计在圆内的坐标的数目 n ， 再除以生成的所有坐标的数目 n / m。由于我们的采样范围只覆盖了1/4的圆， 所以结果需要乘上4 就是圆周率的结果了</p>
<h1 id="如何计算自然常数"><a href="#如何计算自然常数" class="headerlink" title="如何计算自然常数"></a>如何计算自然常数</h1><p>自然常数也一直是我不理解的一个数字</p>
<p>之前听说过一个类比,讲的挺好的,但当时并没有去仔细考虑过计算的方法<a href="http://www.ruanyifeng.com/blog/2011/07/mathematical_constant_e.html" target="_blank" rel="noopener">数学常数e的含义</a></p>
<h2 id="自然常数的意义"><a href="#自然常数的意义" class="headerlink" title="自然常数的意义"></a>自然常数的意义</h2><blockquote>
<p>自然常数代表单位时间内,数量翻倍增长的极限</p>
</blockquote>
<p>比如: 你有1万块钱, 假如存到银行, 1年到期的复利是100%, 那你到明年最多可以拿到多少钱 , 答案是: 2.71828万</p>
<p>这里我们看如何计息:</p>
<p>如果按照每半年计息, 1年后等于 (1 + (100%/2)) * (1 + (100%/2)) = 2.25 万</p>
<p>如果按照每3个月计息一次: 1 + (100%/4) ^ 4 = 2.4414万</p>
<p>如果按照每1个月计算一次 1 + (100%/12) ^12 = 2.6034 万</p>
<p>如果再往下, 每天, 每分钟, 每秒, 最终得到的就是 lim (1+100%/n)^n 的极限就是 2.71828…</p>
<h2 id="如何计算e"><a href="#如何计算e" class="headerlink" title="如何计算e"></a>如何计算e</h2><p>后来也找到一种数学方法可以计算</p>
<p><code>e = 1/(0!)+1/(1!)+1/(2!)+1/(3!)+1/(4!)....1/(n!)</code></p>
<p>于是一时好奇就使用程序实现了一下,如下:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Calculator</span>:</span></span><br><span class="line"></span><br><span class="line">    num = <span class="number">10000000</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPi</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">1</span>, self.num):</span><br><span class="line">            m = <span class="number">1</span> / (<span class="number">1</span> + <span class="number">2</span> * n)</span><br><span class="line">            <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                self.a = self.a + m</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.a = self.a - m</span><br><span class="line">        print(self.a * <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getE</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">0</span>, self.num):</span><br><span class="line">            self.res = self.res + <span class="number">1</span> / math.factorial(n)</span><br><span class="line">        print(self.res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = Calculator()</span><br><span class="line">c.getPi()</span><br><span class="line">c.getE()</span><br></pre></td></tr></tbody></table></figure>

<h2 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h2><p>在线测试demo(js版)</p>
<ol>
<li>计算pi</li>
</ol>
<div id="cal-pi">
    <p>精度:<input v-model="input" type="number" value=""></p><button class="btn btn-info" v-on:click="calculate">Calculate</button>
    <p>结果: <input v-model="result" readonly="true"> </p>
</div>

<ol start="2">
<li>计算E</li>
</ol>
<div id="cal-e">
    <p>精度:<input type="number" v-model="input" value=""></p><button class="btn btn-info" v-on:click="calculate">Calculate</button>
    <p>结果: <input v-model="result" readonly="true"> </p>   
</div>

<ol start="3">
<li>计算你当前的年龄, 精确值, 让你清晰感受时间的流逝</li>
</ol>
<div id="cal-age">
    <p>生日:<input type="text" v-model="input" value="" placeholder="2017-01-01"></p><button class="btn btn-info" v-on:click="calculate">Calculate</button>
    <p>结果: <input v-model="result" readonly="true"> </p>
</div>

<script>
var arr = [{
    el:"#cal-e",
    data:{
        result:0,
        input:100,
        msg:"请输入一个精度值"
    },
    methods:{
        calculate:function(){
            if (!this.input) {
                alert(this.msg);
            }
            var n = this.input;
            var s = 0;
            for (var i = 0; i <= n; i++) {
                s = s + (1 / this.factorial(i));
            }
            this.result = s;
        },
        factorial: function(n) {
            if (n <= 1) return 1;
            return n * this.factorial(n - 1);
        }
    }
},{
    el:"#cal-age",
    data:{
        result:0,
        input:'2000-01-01',
        msg:"请输入一个出生日期",
        n:0
    },
    methods:{
        calculate:function(){
            if (!this.input) {
                alert(this.msg);
            }
            this.n = 0;
            this.interval = setInterval(this.setAge,100);
        },
        setAge:function (){
            this.n += 1;
            var b = this.input;
            var now = new Date().valueOf();
            var born = new Date(b).valueOf();
            var age = (now - born) / (365 * 24 * 3600 * 1000);
            this.result = age;
            this.stop()
        },
        stop:function() {
            if (this.n > 50) clearInterval(this.interval)
        }
    }
},{
    el:"#cal-pi",
    data:{
        result:0,
        input:100,
        msg:"请输入一个精度值"
    },
    methods:{
        calculate:function(){
            if (!this.input) {
                alert(this.msg);
            }
            var n = this.input * 100;
            var s = 1;
            for (var i = 1; i <= n; i++) {
                var m = 1 / (1 + 2 * i);
                if (i % 2 == 0) {
                    s += m;
                } else {
                    s -= m;
                }
            }
            this.result = s * 4;
        }
    }
}];

for (e in arr) {
    new Vue(arr[e]);
}

</script>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2016-08-03-camanjs-demo/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016-08-03-camanjs-demo/" class="post-title-link" itemprop="url">Caman.js的图片处理演示</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-01-05 00:00:00" itemprop="dateCreated datePublished" datetime="2016-01-05T00:00:00+08:00">2016-01-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2016-08-03-camanjs-demo/" class="post-meta-item leancloud_visitors" data-flag-title="Caman.js的图片处理演示" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016-08-03-camanjs-demo/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016-08-03-camanjs-demo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-P75AfVrDnfsoUfx7dDfQM9ivlDhxgE+g4kqO/U7lyXtJwJdpZozbt8L5ywD2PDA0" src="https://lib.baomitu.com/vue/2.5.21/vue.min.js"></script>
<script src="https://cdn.bootcss.com/camanjs/4.1.2/caman.full.min.js"></script>

<h1 id="CamanJS图形处理库"><a href="#CamanJS图形处理库" class="headerlink" title="CamanJS图形处理库"></a>CamanJS图形处理库</h1><p>之前我曾想过自己做一个简单的图片处理库自己用,后来做了几个基本效果以后发现了成本太高</p>
<p>然后就放弃了,去找了个现成的图形库:CamanJS</p>
<p>发现用起来也不错,也就没有再做下去</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="http://camanjs.com/" target="_blank" rel="noopener">CamanJS</a>是一个图片处理类库,能十分方便的处理图片</p>
<p>本身已经提供了许多效果和操作</p>
<p>使用起来也十分方便</p>
<p>项目地址：<a href="https://github.com/meltingice/CamanJS/" target="_blank" rel="noopener">https://github.com/meltingice/CamanJS/</a></p>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><p>在头文件中引入文件<a href="//cdn.bootcss.com/camanjs/4.1.2/caman.full.min.js" target="_blank" rel="noopener">//cdn.bootcss.com/camanjs/4.1.2/caman.full.min.js</a></p>
<p>然后就可以直接使用内置的函数和效果了</p>
<p>例如：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Caman(<span class="string">"#image"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{</span><br><span class="line">    <span class="keyword">this</span>.stackBlur(<span class="number">5</span>).render()  <span class="comment">//模糊处理，模糊半径5像素</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h2 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h2><p><button class="btn btn-info" id="reset">RESET</button>(尽量使用chrome浏览器,请等待网页加载完毕)</p>
<div>
    <div id="stage">
        <img id="image" data-src="https://i.loli.net/2020/05/09/1LzfsPa7U6D3oWx.png" style="float: auto">
    </div>
</div>


<h1 id="预置效果"><a href="#预置效果" class="headerlink" title="预置效果"></a>预置效果</h1><p><code>Caman</code>内置了一批现成的图片效果，使用起来非常简单<br><code>this.revert()</code>用来重置图片效果,保证各个效果不互相影响<br><code>this.lomo()</code>将lomo效果用到图片上<br><code>this.render()</code>渲染图片</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caman(<span class="string">"#image"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{</span><br><span class="line">    <span class="keyword">this</span>.revert();</span><br><span class="line">    <span class="keyword">this</span>.lomo();</span><br><span class="line">    <span class="keyword">this</span>.render();</span><br><span class="line">    })</span><br></pre></td></tr></tbody></table></figure>
<p>执行<code>love</code>效果: <button class="btn btn-info" onclick="javascript:love_render()">RUN LOVE</button></p>
<p>其他预置效果还有</p>
<p><code>lomo</code>,<code>vintage</code>,<code>clarity</code>,<code>sinCity</code>,<code>sunrise</code>,<code>crossProcess</code>,<code>orangePeel</code>,<code>grungy</code>,<code>jarques</code>,<br><code>pinhole</code>,<code>oldBoot</code>,<code>glowingSun</code>,<code>hazyDays</code>,<code>herMajesty</code>,<code>nostalgia</code>,<code>hemingway</code>,<code>concentrate</code><br>等</p>
<p>将以上方法替换文本框中的<code>lomo</code>,例如 <code>this.hazyDays();</code>,然后点 RUN 就行了</p>
<h2 id="Camanjs缺点"><a href="#Camanjs缺点" class="headerlink" title="Camanjs缺点"></a>Camanjs缺点</h2><p>不适合用来做粒度极细的像素级操作,虽然提供了方法</p>
<script type="text/javascript">
    function love_render(){
        Caman("#image",function(){
        this.revert();
        this.love();
        this.render();
        })
    }
    function init() {
        var list = [{
            "name": "brightness",
        }, {
            "name": "contrast",
        }, {
            "name": "vibrance",
        }, {
            "name": "saturation",
        }, {
            "name": "exposure"
        }, {
            "name": "hue",
            "value": 100
        }, {
            "name": "clip",
            "value": 100
        }, {
            "name": "sepia",
            "value": 100
        }, {
            "name": "gamma",
            "value": 10
        }, {
            "name": "noise",
            "value": 100
        }, {
            "name": "sharpen",
            "value": 100
        }, {
            "name": "stackBlur",
            "value": 30
        }];
        var table = document.createElement("table");
        for (var i = 0; i < list.length; i++) {
            if (i % 2 == 0) {
                var tr = document.createElement("tr");
                $(tr).attr("id", "tr" + i);
            }
            var td1 = document.createElement("td");
            var td2 = document.createElement("td");
            var td3 = document.createElement("td");
            $(td1).attr("width","15%");
            $(td2).attr("width","20%");
            $(td3).attr("width","5%");
            $(td1).append(list[i].name);
            if (list[i].value > 0) {
                $(td2).append("<input id=" + list[i].name + "_i value=0 type='range' min=0 max=" + list[i].value + " step=1 data-filter=" + list[i].name + ">")
            } else {
                $(td2).append("<input id=" + list[i].name + "_i value=0 type='range' min=-100 max=100 step=1 data-filter=" + list[i].name + ">");
            }
            $(td3).append(0);
            $(tr).append(td1).append(td2).append(td3);
            $(table).append(tr);
        }
        $(table).css("border", "1px solid #ccc");
        $("#stage").append(table);
    }
    init();
    $("input[type=range]").change(function() {
        var stackBlur_v = $("#stackBlur_i").val();
        var brightness_v = $("#brightness_i").val();
        var contrast_v = $("#contrast_i").val();
        var vibrance_v = $("#vibrance_i").val();
        var saturation_v = $("#saturation_i").val();
        var exposure_v = $("#exposure_i").val()
        var hue_v = $("#hue_i").val()
        var clip_v = $("#clip_i").val()
        var sepia_v = $("#sepia_i").val()
        var gamma_v = $("#gamma_i").val()
        var sharpen_v = $("#sharpen_i").val()
        var noise_v = $("#noise_i").val()
        $(this).parent().next().text($(this).val());
        Caman("#image", function() {
            this.revert();
            if (stackBlur_v > 0) this.stackBlur(stackBlur_v);
            if (brightness_v > 0) this.brightness(brightness_v);
            if (contrast_v > 0) this.contrast(contrast_v);
            if (vibrance_v > 0) this.vibrance(vibrance_v);
            if (saturation_v > 0) this.saturation(saturation_v);
            if (exposure_v > 0) this.exposure(exposure_v);
            if (hue_v > 0) this.hue(hue_v);
            if (clip_v > 0) this.clip(clip_v);
            if (sepia_v > 0) this.sepia(sepia_v);
            if (gamma_v > 0) this.gamma(gamma_v);
            if (sharpen_v > 0) this.sharpen(sharpen_v);
            if (noise_v > 0) this.noise(noise_v);
            this.render();
        })
        $("#reset").click(function(){
            Caman("#image",function(){
                this.revert();
                this.render();
            })
        })
    });
</script>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2015-12-30-design-pattern/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015-12-30-design-pattern/" class="post-title-link" itemprop="url">常用的设计模式总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-12-30 00:00:00" itemprop="dateCreated datePublished" datetime="2015-12-30T00:00:00+08:00">2015-12-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2015-12-30-design-pattern/" class="post-meta-item leancloud_visitors" data-flag-title="常用的设计模式总结" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2015-12-30-design-pattern/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2015-12-30-design-pattern/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>总结一些常用的设计模式</p>
<h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><ul>
<li><strong>概念</strong></li>
</ul>
<p>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作</p>
<ul>
<li><strong>主要角色</strong></li>
</ul>
<p><strong>目标(Target)角色</strong>：定义客户端使用的与特定领域相关的接口，这也就是我们所期待得到的</p>
<p><strong>源(Adaptee)角色</strong>：需要进行适配的接口</p>
<p><strong>适配器(Adapter)角色</strong>：对Adaptee的接口与Target接口进行适配；适配器是本模式的核心，适配器把源接口转换成目标接口，此角色为具体类</p>
<ul>
<li><strong>适用性</strong> </li>
</ul>
<ol>
<li>你想使用一个已经存在的类，而它的接口不符合你的需求</li>
<li>你想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类协同工作</li>
<li>你想使用一个已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口（仅限于对象适配器）</li>
</ol>
<p>在实际应用中，适配器模式分为类适配器和对象适配器</p>
<p><strong>类适配器</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标角色</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ITarget</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">operation2</span><span class="params">()</span></span>;  </span><br><span class="line">}  </span><br><span class="line"><span class="comment">//源角色  </span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IAdaptee</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span></span>;  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">IAdaptee</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"原方法"</span>;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br><span class="line"></span><br><span class="line"><span class="comment">//适配器角色  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">IAdaptee</span>, <span class="title">ITarget</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">operation2</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"适配方法"</span>;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        $adapter = <span class="keyword">new</span> Adapter();  </span><br><span class="line">        $adapter-&gt;operation1();<span class="comment">//原方法  </span></span><br><span class="line">        $adapter-&gt;operation2();<span class="comment">//适配方法  </span></span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>对象适配器</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标角色</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ITarget</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">operation2</span><span class="params">()</span></span>;  </span><br><span class="line">}  </span><br><span class="line"><span class="comment">//源角色   </span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IAdaptee</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span></span>;  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">IAdaptee</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"原方法"</span>;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br><span class="line"><span class="comment">//适配器角色  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">ITarget</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">private</span> $adaptee;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adaptee)</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;adaptee = $adaptee;  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">operation1</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;adaptee-&gt;operation1();  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">operation2</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"适配方法"</span>;  </span><br><span class="line">    }  </span><br><span class="line">    </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        $adapter = <span class="keyword">new</span> Adapter(<span class="keyword">new</span> Adaptee(<span class="keyword">null</span>));  </span><br><span class="line">        $adapter-&gt;operation1();<span class="comment">//原方法  </span></span><br><span class="line">        $adapter-&gt;operation2();<span class="comment">//适配方法  </span></span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>类适配器中适配器继承原有的Adaptee类，自己实现原类没有的操作，使用的是继承模式，而对象适配器使用的是组合模式，将adaptee作为adapter的一个引用。由于组合在耦合性上小于继承，对象适配器显得更加灵活但缺点是增加代码量。 需要重写adapee中的方法的数量太大的话，可以考虑在adapter类中添加<code>__call</code>方法委托adapee取得客户端调用的方法</p>
</blockquote>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func, $args)</span>  </span></span><br><span class="line"><span class="function"></span>{  </span><br><span class="line">    <span class="keyword">if</span> (is_callable(<span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;adaptee, $func))) {  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;adaptee-&gt;$func($args);  </span><br><span class="line">    }  </span><br><span class="line">    trigger_error(<span class="string">'*********'</span>, E_USER_ERROR);  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


<h1 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h1><ul>
<li><strong>装饰器模式概念</strong></li>
</ul>
<blockquote>
<p>在不必改变原类文件和使用继承的情况下，动态地扩展一个对象的功能，它是通过创建一个包装对象，也就是装饰来包裹真实的对象。</p>
</blockquote>
<ul>
<li><strong>装饰器模式特点</strong></li>
</ul>
<ol>
<li>装饰对象和真实对象有相同的接口。这样客户端对象就能以和真实对象相同的方式和装饰对象交互。</li>
<li>装饰对象包含一个真实对象的引用（reference）</li>
<li>装饰对象接受所有来自客户端的请求。它把这些请求转发给真实的对象。</li>
<li>装饰对象可以在转发这些请求以前或以后增加一些附加功能。这样就确保了在运行时，不用修改给定对象的结构就可以在外部增加附加的功能。在面向对象的设计中，通常是通过继承来实现对给定类的功能扩展。</li>
</ol>
<ul>
<li><strong>适用性</strong></li>
</ul>
<ol>
<li>需要扩展一个类的功能，或给一个类添加附加职责。</li>
<li>需要动态的给一个对象添加功能，这些功能可以再动态的撤销。</li>
<li>需要增加由一些基本功能的排列组合而产生的非常大量的功能，从而使继承关系变的不现实。</li>
<li>当不能采用生成子类的方法进行扩充时。一种情况是，可能有大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长。另一种情况可能是因为类定义被隐藏，或类定义不能用于生成子类。</li>
</ol>
<ul>
<li><strong>优点</strong></li>
</ul>
<ol>
<li>Decorator模式与继承关系的目的都是要扩展对象的功能，但是Decorator可以提供比继承更多的灵活性。</li>
<li>通过使用不同的具体装饰类以及这些装饰类的排列组合，设计师可以创造出很多不同行为的组合。</li>
</ol>
<ul>
<li><strong>缺点</strong></li>
</ul>
<ol>
<li>这种比继承更加灵活机动的特性，也同时意味着更加多的复杂性。</li>
<li>装饰模式会导致设计中出现许多小类，如果过度使用，会使程序变得很复杂。</li>
<li>装饰模式是针对抽象组件（Component）类型编程。但是，如果你要针对具体组件编程时，就应该重新思考你的应用架构，以及装饰者是否合适。当然也可以改变Component接口，增加新的公开的行为，实现“半透明”的装饰者模式。在实际项目中要做出最佳选择。</li>
</ol>
<ul>
<li><strong>设计原则</strong></li>
</ul>
<ol>
<li>多用组合，少用继承。</li>
<li>类应设计的对扩展开放，对修改关闭。</li>
</ol>
<ul>
<li><strong>装饰器模式实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//抽象接口类</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IDecorator</span></span>{</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sayMsg</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体装饰类1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">decorator1</span> <span class="keyword">implements</span> <span class="title">IDecorator</span></span>{</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sayMsg</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"增加功能1"</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//具体装饰类2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">decorator2</span> <span class="keyword">implements</span> <span class="title">IDecorator</span></span>{</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sayMsg</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"增加功能2"</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MailTest</span></span>{</span><br><span class="line">    <span class="keyword">private</span> $decorators;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addDecorator</span><span class="params">(IDecorator $decorator)</span></span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;decorators[] = $decorator;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addExtraFunction</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;decorators <span class="keyword">as</span> $decorator) {</span><br><span class="line">            $decorator-&gt;sayMsg();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;addExtraFunction();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"I am test"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$mailTest = <span class="keyword">new</span> MailTest();</span><br><span class="line"></span><br><span class="line">$decorator1 = <span class="keyword">new</span> decorator1();</span><br><span class="line">$decorator2 = <span class="keyword">new</span> decorator2();</span><br><span class="line"></span><br><span class="line">$mailTest-&gt;addDecorator($decorator1);</span><br><span class="line">$mailTest-&gt;addDecorator($decorator2);</span><br><span class="line"></span><br><span class="line">$mailTest-&gt;test();</span><br></pre></td></tr></tbody></table></figure>

<h1 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h1><ul>
<li><strong>概念及特点</strong></li>
</ul>
<p>面向对象设计强调抽象类高于实现，也就是说我们要尽量一般化而不是特殊化，工厂模式解决了当代码关于抽象类型时如何创建对象实例的问题。</p>
<p>工厂模式就是把创建对象的过程封装起来，这样随时可以产生一个新的对象，减少代码之间耦合。</p>
<p>通俗的说，常规的创建一个对象要使用new，工厂模式就是把这个过程封装起来，使用一个工厂类来创建对象</p>
<p>如果不使用工厂模式，那么很多地方调用类Database，代码就会这样子创建一个实例：new Database(),假设某天需要修改Database类的名称那么调用Database类的代码都要修改。</p>
<ul>
<li><strong>工厂模式举例</strong></li>
</ul>
<p>假如已经有一个数据库类Database</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>{</span><br><span class="line">	$db = <span class="keyword">new</span> Database();</span><br><span class="line">	<span class="keyword">return</span> $db;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>创建数据库类</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$db = Factory::createDatabase();</span><br></pre></td></tr></tbody></table></figure>

<h1 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h1><ul>
<li><strong>概念</strong></li>
</ul>
<blockquote>
<p>为创建一组相关或相互依赖的对象提供一个接口，而且无需指定他们的具体类</p>
</blockquote>
<ul>
<li><strong>特点</strong></li>
</ul>
<p>抽象工厂模式（Abstact Factory）是一种常见的软件设计模式，该模式为一个产品族提供了统一的创建接口。当需要这个产品族的某一系列的时候，可以为此系列的产品族创建一个具体的工厂类。</p>
<ul>
<li><strong>主要角色</strong></li>
</ul>
<p><strong>抽象工厂(Abstract Factory)角色</strong>：它声明一个创建抽象产品对象的接口。通常以接口或抽象类实现，所有的具体工厂类必须实现这个接口或继承这个类。</p>
<p><strong>具体工厂(Concrete Factory)角色</strong>：实现创建产品对象的操作。客户端直接调用这个角色创建产品的实例。这个角色包含有选择合适的产品对象的逻辑。通常使用具体类实现。</p>
<p><strong>抽象产品(Abstract Product)角色</strong>：声明一类产品的接口。它是工厂方法模式所创建的对象的父类，或它们共同拥有的接口。</p>
<p><strong>具体产品(Concrete Product)角色</strong>：实现抽象产品角色所定义的接口，定义一个将被相应的具体工厂创建的产品对象。其内部包含了应用程序的业务逻辑。</p>
<ul>
<li><strong>优缺点</strong></li>
</ul>
<p><strong>抽象工厂模式的优点</strong>:</p>
<ol>
<li>分离了具体的类</li>
<li>使增加或替换产品族变得容易</li>
<li>有利于产品的一致性</li>
</ol>
<p><strong>抽象工厂模式的缺点</strong>:</p>
<p>难以支持新种类的产品。这是因为AbstractFactory接口确定了可以被创建的产品集合。支持新各类的产品就需要扩展访工厂接口，从而导致AbstractFactory类及其所有子类的改变。<br>抽象工厂就是以一种倾斜的方式支持增加新的产品中，它为新产品族的增加提供了方便，而不能为新的产品等级结构的增加提供这样的方便。</p>
<ul>
<li><strong>适用性</strong></li>
</ul>
<ol>
<li>一个系统不应当依赖于产品类实例如何被创建、组合和表达的细节，这对于所有形态的工厂模式都是重要的。</li>
<li>这个系统的产品有多于一个的产品族，而系统只消费其中某一族的产品。</li>
<li>同属于同一个产品族的产品是在一起使用的，这一约束必须在系统的设计中体现出来。</li>
<li>系统提供一个产品类的库，所有的产品以同样的接口出现，从而使用客户端不依赖于实现</li>
</ol>
<ul>
<li><strong>抽象工厂模式实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//抽象工厂</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AnimalFactory</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createCat</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createDog</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体工厂</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackAnimalFactory</span> <span class="keyword">implements</span> <span class="title">AnimalFactory</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createCat</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BlackCat();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createDog</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BlackDog();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteAnimalFactory</span> <span class="keyword">implements</span> <span class="title">AnimalFactory</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createCat</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WhiteCat();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createDog</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WhiteDog();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象产品</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Cat</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Voice</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Dog</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Voice</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体产品</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackCat</span> <span class="keyword">implements</span> <span class="title">Cat</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Voice</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'黑猫喵喵喵'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteCat</span> <span class="keyword">implements</span> <span class="title">Cat</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Voice</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'白猫喵喵喵'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackDog</span> <span class="keyword">implements</span> <span class="title">Dog</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Voice</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'黑狗汪汪汪'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteDog</span> <span class="keyword">implements</span> <span class="title">Dog</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Voice</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'白狗汪汪汪'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">self</span>::run(<span class="keyword">new</span> BlackAnimalFactory());</span><br><span class="line">        <span class="keyword">self</span>::run(<span class="keyword">new</span> WhiteAnimalFactory());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">(AnimalFactory $AnimalFactory)</span></span>{</span><br><span class="line">        $cat = $AnimalFactory-&gt;createCat();</span><br><span class="line">        $cat-&gt;Voice();</span><br><span class="line"></span><br><span class="line">        $dog = $AnimalFactory-&gt;createDog();</span><br><span class="line">        $dog-&gt;Voice();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">Client::main();</span><br></pre></td></tr></tbody></table></figure>

<h1 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h1><ul>
<li><strong>迭代器模式概念</strong></li>
</ul>
<blockquote>
<p>在不需要了解内部实现的前提下，遍历一个聚合对象的内部元素而又不暴露该对象的内部表示。</p>
</blockquote>
<ul>
<li><strong>适用场景</strong></li>
</ul>
<ul>
<li>访问一个聚合对象的内容而无需暴露它的内部表示</li>
<li>支持对聚合对象的多种遍历</li>
<li>为遍历不同的聚合结构提供一个统一的接口</li>
</ul>
<ul>
<li><strong>迭代器模式实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span>{</span><br><span class="line">	<span class="keyword">private</span> $position = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> $arr;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $arr)</span></span>{</span><br><span class="line">		<span class="keyword">$this</span>-&gt;arr = $arr;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">rewind</span><span class="params">()</span></span>{</span><br><span class="line">		<span class="keyword">$this</span>-&gt;position = <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">current</span><span class="params">()</span></span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;arr[<span class="keyword">$this</span>-&gt;position];</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">key</span><span class="params">()</span></span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;position;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">()</span></span>{</span><br><span class="line">		++<span class="keyword">$this</span>-&gt;position;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">valid</span><span class="params">()</span></span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;arr[<span class="keyword">$this</span>-&gt;position]);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$arr = <span class="keyword">array</span>(<span class="string">'xiao hong'</span>,<span class="string">'xiao ming'</span>,<span class="string">'xiaohua'</span>);</span><br><span class="line">$concreteIterator = <span class="keyword">new</span> ConcreteIterator($arr);</span><br><span class="line"><span class="keyword">foreach</span> ($concreteIterator <span class="keyword">as</span> $key =&gt; $value) {</span><br><span class="line">	<span class="keyword">echo</span> $key.<span class="string">"=&gt;"</span>.$value.<span class="string">"\n"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h1><ul>
<li><strong>观察者模式概念</strong></li>
</ul>
<blockquote>
<p>观察者模式（有时又被称为发布（publish）-订阅（Subscribe）模式、模型-视图（View）模式、源-收听者(Listener)模式或从属者模式），在此种模式中，当一个对象状态发生改变时，依赖它的对象全部会收到通知，并自动更新。</p>
</blockquote>
<ul>
<li><strong>使用场景</strong></li>
</ul>
<p>一个事件发生以后，要执行一连串更新操作，传统编程方法就是在事件的代码之后直接加入处理逻辑，当更新的逻辑增多之后，代码会变得难以维护，这种方式是耦合的，侵入式的，增加新的逻辑需要修改事件主体的代码。观察者模式实现了低耦合非侵入式的通知与更新机制。</p>
<ul>
<li><strong>实现方式</strong></li>
</ul>
<p>从根本上说，该模式必须包含两个角色：观察者和被观察对象。观察者和被观察者之间存在“观察”的逻辑关联，当被观察者发生改变的时候，观察者就会观察到这样的变化。</p>
<ul>
<li><strong>观察者模式实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//观察者，需要用到观察者模式的类需实现此接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($event_info = null)</span></span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//被观察者（一个抽象类，方便扩展）</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observable</span></span>{</span><br><span class="line">    <span class="keyword">private</span> $observers = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addObserver</span><span class="params">(Observer $observer)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers[] = $observer;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">notify</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;observers <span class="keyword">as</span> $observer)</span><br><span class="line">        {</span><br><span class="line">            $observer-&gt;update();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObservable</span> <span class="keyword">extends</span> <span class="title">Observable</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;notify();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer1</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($event_info = null)</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"action one"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer2</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($event_info = null)</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"action two"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$event = <span class="keyword">new</span> ConcreteObservable();</span><br><span class="line"><span class="comment">//添加观察者</span></span><br><span class="line">$event-&gt;addObserver(<span class="keyword">new</span> Observer1);</span><br><span class="line">$event-&gt;addObserver(<span class="keyword">new</span> Observer2);</span><br><span class="line">$event-&gt;trigger();</span><br></pre></td></tr></tbody></table></figure>

<h1 id="数据对象映射-ORM"><a href="#数据对象映射-ORM" class="headerlink" title="数据对象映射(ORM)"></a>数据对象映射(ORM)</h1><ul>
<li><strong>数据对象映射模式概念</strong></li>
</ul>
<blockquote>
<p>将对象和数据存储映射起来，对一个对象的操作会映射为对数据存储的操作</p>
</blockquote>
<ul>
<li><strong>数据对象映射模式实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">protected</span> $id;</span><br><span class="line">    <span class="keyword">protected</span> $data;</span><br><span class="line">    <span class="keyword">protected</span> $db;</span><br><span class="line">    <span class="keyword">protected</span> $change = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = Factory::getDatabase();</span><br><span class="line">        $res = <span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"select * from user where id = $id limit 1"</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = $res-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id = $id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;data[$key]))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[$key];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key, $value)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data[$key] = $value;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;change = <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;change)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;data <span class="keyword">as</span> $k =&gt; $v)</span><br><span class="line">            {</span><br><span class="line">                $fields[] = <span class="string">"$k = '{$v}'"</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"update user set "</span> . implode(<span class="string">', '</span>, $fields) . <span class="string">"where</span></span><br><span class="line"><span class="string">            id = {$this-&gt;id} limit 1"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$user = <span class="keyword">new</span> User(<span class="number">1</span>);</span><br><span class="line">$user-&gt;mobile = <span class="string">'18888888888'</span>；</span><br><span class="line">$user-&gt;name = <span class="string">'test'</span>；</span><br></pre></td></tr></tbody></table></figure>

<h1 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h1><ul>
<li><strong>原型模式概念</strong></li>
</ul>
<blockquote>
<p>用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
</blockquote>
<p>-<strong>使用场景</strong></p>
<p>它主要面对的问题是：“某些结构复杂的对象”的创建工作；由于需求的变化，这些对象经常面临着剧烈的变化，但是他们却拥有比较稳定一致的接口。原型模式适用于大型对象的创建，创建一个大型对象需要很大的开销，如果每次new就会消耗很大，原型模式只需内存拷贝即可</p>
<p>-<strong>主要角色</strong></p>
<ol>
<li>抽象原型(Prototype)角色：声明一个克隆自身的接口</li>
<li>具体原型(Concrete Prototype)角色：实现一个克隆自身的操作</li>
</ol>
<p>-<strong>原型模式实例</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment">//抽象原型</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Prototype</span> </span>{  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">copy</span><span class="params">()</span></span>;   </span><br><span class="line">}     </span><br><span class="line">  </span><br><span class="line"><span class="comment">//具体原型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcretePrototype</span> <span class="keyword">implements</span> <span class="title">Prototype</span> </span>{  </span><br><span class="line">    <span class="keyword">private</span> $name;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;  </span><br><span class="line">    }  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span>{  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;  </span><br><span class="line">    }  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setName</span><span class="params">($name)</span></span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;  </span><br><span class="line">    }  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">//克隆  </span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">copy</span><span class="params">()</span></span>{  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">clone</span> <span class="keyword">$this</span>;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//客户端  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>{  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span></span>{  </span><br><span class="line">          </span><br><span class="line">        $pro = <span class="keyword">new</span> ConcretePrototype(<span class="string">'test'</span>);  </span><br><span class="line">        $pro2 = $pro-&gt;copy();  </span><br><span class="line">        <span class="keyword">echo</span> $pro-&gt;getName();  </span><br><span class="line">        <span class="keyword">echo</span> $pro2-&gt;getName();  </span><br><span class="line">    }   </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line">Client::main();</span><br></pre></td></tr></tbody></table></figure>

<h1 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h1><ul>
<li><strong>代理模式定义</strong></li>
</ul>
<blockquote>
<p>为其他对象提供一种代理以控制对这个对象的访问。在某些情况下，一个对象不适合或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用</p>
</blockquote>
<ul>
<li><p><strong>主要角色</strong></p>
<ul>
<li>抽象角色：通过接口或抽象类声明真实角色实现的业务方法。</li>
<li>代理角色：实现抽象角色，是真实角色的代理，通过真实角色的业务逻辑方法来实现抽象方法，并可以附加自己的操作。</li>
<li>真实角色：实现抽象角色，定义真实角色所要实现的业务逻辑，供代理角色调用。</li>
</ul>
</li>
<li><p><strong>优点</strong></p>
</li>
</ul>
<ol>
<li>职责清晰</li>
<li>代理对象可以在客户端和目标对象之间起到中介的作用，这样起到了中介的作用和保护了目标对象的作用。</li>
<li>高扩展性</li>
</ol>
<ul>
<li><strong>代理模式实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象角色</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IGiveGift</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveRose</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveChocolate</span><span class="params">()</span></span>;  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//真实角色</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Follower</span> <span class="keyword">implements</span> <span class="title">IGiveGift</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">private</span> $girlName;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name=<span class="string">'Girl'</span>)</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;girlName=$name;  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveRose</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"{$this-&gt;girlName}:送你的玫瑰&lt;br/&gt;"</span>;  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveChocolate</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"{$this-&gt;girlName}:送你的巧克力&lt;br/&gt;"</span>;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">//代理角色</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">IGiveGift</span>  </span></span><br><span class="line"><span class="class"></span>{  </span><br><span class="line">    <span class="keyword">private</span> $follower;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name=<span class="string">'Girl'</span>)</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;follower=<span class="keyword">new</span> Follower($name);  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveRose</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;follower-&gt;giveRose();  </span><br><span class="line">    }  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveChocolate</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>{  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;follower-&gt;giveChocolate();  </span><br><span class="line">    }  </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$proxy=<span class="keyword">new</span> Proxy(<span class="string">'xxx'</span>);  </span><br><span class="line">$proxy-&gt;giveRose();  </span><br><span class="line">$proxy-&gt;giveChocolate();</span><br></pre></td></tr></tbody></table></figure>

<h1 id="注册树模式"><a href="#注册树模式" class="headerlink" title="注册树模式"></a>注册树模式</h1><ul>
<li><strong>注册树模式概念</strong></li>
</ul>
<blockquote>
<p>注册树模式也叫注册模式或注册器模式。注册树模式将对象实例注册到一棵全局的对象树上，需要的时候从对象树上获取即可。   </p>
</blockquote>
<ul>
<li><strong>注册树模式优点</strong></li>
</ul>
<p>　　单例模式创建唯一对象的过程本身还有一种判断，即判断对象是否存在，存在则返回对象，不存在则创建对象并返回。 工厂模式更多考虑的是扩展维护的问题。 总的来说，单例模式和工厂模式可以产生更加合理的对象。怎么方便调用这些对象呢？注册树模式是一种不错的选择。不管是通过单例模式还是工厂模式还是二者结合生成的对象，都统统给我插入到注册树上，用某个对象的时候，直接从注册树上获取即可。</p>
<ul>
<li><strong>注册树模式实例</strong></li>
</ul>
<p>假如已经存在类Database；</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> $objects;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">($alias, $object)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">self</span>::$objects[$alias] = $object;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">self</span>::$objects[$key]))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$objects[$key];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_unset</span><span class="params">($alias)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">self</span>::$objects[$alias]);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span></span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>{</span><br><span class="line">	$db = <span class="keyword">new</span> Database();</span><br><span class="line">	<span class="comment">//插入到注册树</span></span><br><span class="line">	Register::set(<span class="string">'db1'</span>, $db);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//从注册树里获取</span></span><br><span class="line">$db = Register::get(<span class="string">'db1'</span>);</span><br></pre></td></tr></tbody></table></figure>


<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><ul>
<li><strong>单例模式概念</strong></li>
</ul>
<blockquote>
<p>一个类有且仅有一个实例，并且自行实例化向整个系统提供</p>
</blockquote>
<ul>
<li><strong>单例模式的特点</strong></li>
</ul>
<ol>
<li>一个类在整个应用中只有一个实例</li>
<li>类必须自行创建这个实例</li>
<li>必须自行向整个系统提供这个实例</li>
</ol>
<ul>
<li><strong>单例模式举例</strong></li>
</ul>
<p>一个应用中有一个数据库的类Database，如果不用单例模式，每次new都会消耗大量的资源，而且每次打开和关闭数据库连接也会消耗一些资源，如果使用单例模式则不会存在这些问题。<br>使用单例模式实现代码：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Database</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="keyword">self</span>::$db)) {</span><br><span class="line">            <span class="keyword">self</span>::$db = <span class="keyword">new</span> <span class="keyword">self</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>::$db;</span><br><span class="line">        } </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$db;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>使用方法：</p>
<p><code>$db = Database::getInstance();</code></p>
<h1 id="state模式"><a href="#state模式" class="headerlink" title="state模式"></a>state模式</h1><ul>
<li><strong>概念</strong></li>
</ul>
<blockquote>
<p>不同的状态,不同的行为;或者说,每个状态有着相应的行为.</p>
</blockquote>
<ul>
<li><strong>使用场景</strong></li>
</ul>
<p>State模式在实际使用中比较多,适合”状态的切换”.因为我们经常会使用<code>If elseif else</code> 进行状态切换, 如果针对状态的这样判断切换反复出现,我们就要联想到是否可以采取State模式了.</p>
<p>不只是根据状态,也有根据属性.如果某个对象的属性不同,对象的行为就不一样,这点在数据库系统中出现频率比较高,我们经常会在一个数据表的尾部,加上property属性含义的字段,用以标识记录中一些特殊性质的记录,这种属性的改变(切换)又是随时可能发生的,就有可能要使用State.</p>
<p><strong>适用性</strong>：</p>
<p>在下面的两情况下均可以使用State模式：</p>
<ol>
<li>一个对象的行为取决于它的状态，并且必须在运行时刻根据状态改变它的行为。</li>
<li>一个操作中含有庞大的多分支的条件豫剧，并且这些分支依赖于该对象的状态，这个状态通常用一个或多个枚举常量表示。通常，有多个操作包含这一相同的条件结构，State模式将每一个条件分支放入一个单独的类中。这使得你可以根据对象自身的情况将对象的状态作为一个对象，这一对象可以不依赖于其他对象而独立变化。</li>
</ol>
<ul>
<li><p><strong>参与者</strong></p>
</li>
<li><p>Context(环境，Person)定义客户感兴趣的类。</p>
</li>
<li><p>State(Moodstate)：定义一个接口以封装与Context的一个特定状态相关的行为</p>
</li>
<li><p>ConcreteState Subclasses(具体状态子类，如Angry)每一个子类实现一个与Context的状态相关的行为。</p>
</li>
</ul>
<p>他们的协作关系是：</p>
<ul>
<li><p>Context将于状态相关的请求委托给当前的ConcreteState对象处理。</p>
</li>
<li><p>Context可将自身作为一个参数传递给处理该请求的状态对象，这使得状态对象在必要的时候可访问Context。</p>
</li>
<li><p>Context是客户使用的主要接口，客户可用状态对象来配置一个Context，一旦一个Context配置完毕，他的客户不再需要直接与状态对象打交道。</p>
</li>
<li><p>Context或者ConcreteState子类都可以决定哪个状态是另外那个状态的后继者，以及是在何种条件下进行状态转换。</p>
</li>
<li><p><strong>如何使用</strong></p>
</li>
</ul>
<p>State需要两种类型实体参与:</p>
<ol>
<li>state manager 状态管理器 ,就是开关 ,如上面例子的Context实际就是一个state manager, 在state manager中有对状态的切换动作.</li>
<li>用抽象类或接口实现的父类,,不同状态就是继承这个父类的不同子类.</li>
</ol>
<p>以上面的Context为例.我们要修改它,建立两个类型的实体.<br>第一步: 首先建立一个父类:</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MoodState</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeState</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>父类中的方法要对应state manager中的开关行为,在state manager中 本例就是Context中,开关动作为changeState.那么在状态父类中就要有具体处理这个动作:changeState(); 同时还需要一个doSomething();</p>
<p>下面是具体子类的实现:</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Angry</span> <span class="keyword">implements</span> <span class="title">MoodState</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($p)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = $p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"i am angry\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeState</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p-&gt;setState(<span class="keyword">new</span> Happy(<span class="keyword">$this</span>-&gt;p));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>同样 其他状态的子类实现如Angry一样.</p>
<p>第二步: 要重新改写State manager 也就是本例的Context:</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state = <span class="keyword">new</span> Mad(<span class="keyword">$this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setState</span><span class="params">($state)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state = $state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;doSomething();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;changeState();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>至此,我们也就实现了State的refactorying过程.</p>
<p>以上只是相当简单的一个实例,在实际应用中,处理是复杂的.</p>
<p><strong>状态模式优点</strong>：</p>
<ol>
<li>封装转换过程，也就是转换规则</li>
<li>枚举可能的状态，因此，需要事先确定状态种类。</li>
</ol>
<blockquote>
<p>状态模式可以允许客户端改变状态的转换行为，而状态机则是能够自动改变状态，状态机是一个比较独立的而且复杂的机制，具体可参考一个状态机开源项目：<a href="http://sourceforge.net/projects/smframework/" target="_blank" rel="noopener">项目地址</a></p>
</blockquote>
<p>状态模式在工作流或游戏等各种系统中有大量使用，甚至是这些系统的核心功能设计，例如政府OA中，一个批文的状态有多种：未办；正在办理；正在批示；正在审核；已经完成等各种状态，使用状态机可以封装这个状态的变化规则，从而达到扩充状态时，不必涉及到状态的使用者。</p>
<p>在网络游戏中，一个游戏活动存在开始；开玩；正在玩；输赢等各种状态，使用状态模式就可以实现游戏状态的总控，而游戏状态决定了游戏的各个方面，使用状态模式可以对整个游戏架构功能实现起到决定的主导作用。</p>
<p>状态模式实质：</p>
<p><strong>使用状态模式前，客户端外界需要介入改变状态，而状态改变的实现是琐碎或复杂的。</strong></p>
<p>使用状态模式后，客户端外界可以直接使用事件Event实现，根本不必关心该事件导致如何状态变化，这些是由状态机等内部实现。</p>
<p>这是一种Event-condition-State，状态模式封装了condition-State部分。</p>
<p>每个状态形成一个子类，每个状态只关心它的下一个可能状态，从而无形中形成了状态转换的规则。如果新的状态加入，只涉及它的前一个状态修改和定义。</p>
<p>状态转换有几个方法实现：一个在每个状态实现next()，指定下一个状态；还有一种方法，设定一个StateOwner，在StateOwner设定stateEnter状态进入和stateExit状态退出行为。</p>
<p>状态从一个方面说明了流程，流程是随时间而改变，状态是截取流程某个时间片。</p>
<ul>
<li><strong>实例</strong></li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * state 设计模式.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MoodState</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeState</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Angry</span> <span class="keyword">implements</span> <span class="title">MoodState</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($p)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = $p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"i am angry\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeState</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p-&gt;setState(<span class="keyword">new</span> Happy(<span class="keyword">$this</span>-&gt;p));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Happy</span> <span class="keyword">implements</span> <span class="title">MoodState</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($p)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = $p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"i am Happy\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeState</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p-&gt;setState(<span class="keyword">new</span> Mad(<span class="keyword">$this</span>-&gt;p));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mad</span> <span class="keyword">implements</span> <span class="title">MoodState</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($p)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = $p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"i am mad\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeState</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p-&gt;setState(<span class="keyword">new</span> Angry(<span class="keyword">$this</span>-&gt;p));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state = <span class="keyword">new</span> Mad(<span class="keyword">$this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setState</span><span class="params">($state)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state = $state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;doSomething();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;state-&gt;changeState();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        $p = <span class="keyword">new</span> Person();</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>;$i &lt; <span class="number">10</span>;++$i) {</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"the $i times:"</span>;</span><br><span class="line">            $p-&gt;doSomething();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">new</span> Client();</span><br></pre></td></tr></tbody></table></figure>
<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><ul>
<li><strong>策略模式概念</strong></li>
</ul>
<blockquote>
<p>策略模式定义了一系列的算法，并将每一个算法封装起来，而且使它们还可以相互替换。策略模式让算法独立于使用它的客户而独立变化。</p>
</blockquote>
<ul>
<li><strong>主要角色</strong></li>
</ul>
<ul>
<li>抽象策略角色： 策略类，通常由一个接口或者抽象类实现。</li>
<li>具体策略角色：包装了相关的算法和行为。</li>
<li>环境角色：持有一个策略类的引用，最终给客户端调用。</li>
</ul>
<ul>
<li><strong>应用场景</strong></li>
</ul>
<ol>
<li>多个类只区别在表现行为不同，可以使用Strategy模式，在运行时动态选择具体要执行的行为。</li>
<li>需要在不同情况下使用不同的策略(算法)，或者策略还可能在未来用其它方式来实现。</li>
<li>对客户隐藏具体策略(算法)的实现细节，彼此完全独立。</li>
</ol>
<ul>
<li><strong>优点</strong></li>
</ul>
<ol>
<li>策略模式提供了管理相关的算法族的办法。策略类的等级结构定义了一个算法或行为族。恰当使用继承可以把公共的代码转移到父类里面，从而避免重复的代码。</li>
<li>策略模式提供了可以替换继承关系的办法。继承可以处理多种算法或行为。如果不是用策略模式，那么使用算法或行为的环境类就可能会有一些子类，每一个子类提供一个不同的算法或行为。但是，这样一来算法或行为的使用者就和算法或行为本身混在一起。决定使用哪一种算法或采取哪一种行为的逻辑就和算法或行为的逻辑混合在一起，从而不可能再独立演化。继承使得动态改变算法或行为变得不可能。</li>
<li>使用策略模式可以避免使用多重条件转移语句。多重转移语句不易维护，它把采取哪一种算法或采取哪一种行为的逻辑与算法或行为的逻辑混合在一起，统统列在一个多重转移语句里面，比使用继承的办法还要原始和落后。</li>
</ol>
<ul>
<li><p><strong>缺点</strong></p>
<ol>
<li>客户端必须知道所有的策略类，并自行决定使用哪一个策略类。这就意味着客户端必须理解这些算法的区别，以便适时选择恰当的算法类。换言之，策略模式只适用于客户端知道所有的算法或行为的情况。</li>
<li>策略模式造成很多的策略类，每个具体策略类都会产生一个新类。有时候可以通过把依赖于环境的状态保存到客户端里面，而将策略类设计成可共享的，这样策略类实例可以被不同客户端使用。换言之，可以使用享元模式来减少对象的数量。</li>
</ol>
</li>
<li><p><strong>策略模式实例</strong></p>
</li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*策略模式</span></span><br><span class="line"><span class="comment">*定义一系列的算法,把每一个算法封装起来,并且使它们可相互替换。</span></span><br><span class="line"><span class="comment">*本模式使得算法可独立于使用它的客户变化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*出行旅游</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">TravelStrategy</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*具体策略类(ConcreteStrategy)</span></span><br><span class="line"><span class="comment">*1：乘坐飞机</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirPlanelStrategy</span> <span class="keyword">implements</span> <span class="title">TravelStrategy</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span><span class="string">"travelbyAirPlain"</span>,<span class="string">"&lt;BR&gt;\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*具体策略类(ConcreteStrategy)</span></span><br><span class="line"><span class="comment">*2：乘坐火车</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrainStrategy</span> <span class="keyword">implements</span> <span class="title">TravelStrategy</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span><span class="string">"travelbyTrain"</span>,<span class="string">"&lt;BR&gt;\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*具体策略类(ConcreteStrategy)</span></span><br><span class="line"><span class="comment">*3：骑自行车</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BicycleStrategy</span> <span class="keyword">implements</span> <span class="title">TravelStrategy</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span><span class="string">"travelbyBicycle"</span>,<span class="string">"&lt;BR&gt;\r\n"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*环境类(Context):</span></span><br><span class="line"><span class="comment">*用一个ConcreteStrategy对象来配置。</span></span><br><span class="line"><span class="comment">*维护一个对Strategy对象的引用。可定义一个接口来让Strategy访问它的数据。</span></span><br><span class="line"><span class="comment">*算法解决类，以提供客户选择使用何种解决方案：</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonContext</span></span>{</span><br><span class="line">    <span class="keyword">private</span>$_strategy = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(TravelStrategy $travel)</span></span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_strategy=$travel;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *旅行</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setTravelStrategy</span><span class="params">(TravelStrategy $travel)</span></span>{</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_strategy=$travel;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *旅行</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travel</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span><span class="keyword">$this</span>-&gt;_strategy-&gt;travelAlgorithm();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="comment">//乘坐火车旅行</span></span><br><span class="line">$person=<span class="keyword">new</span> PersonContext(<span class="keyword">new</span> TrainStrategy());</span><br><span class="line">$person-&gt;travel();</span><br><span class="line"></span><br><span class="line"><span class="comment">//改骑自行车</span></span><br><span class="line">$person-&gt;setTravelStrategy(<span class="keyword">new</span> BicycleStrategy());</span><br><span class="line">$person-&gt;travel();</span><br></pre></td></tr></tbody></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2015-09-29-Astar-algorithm/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015-09-29-Astar-algorithm/" class="post-title-link" itemprop="url">学习A*寻路算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-29 18:51:59" itemprop="dateCreated datePublished" datetime="2015-09-29T18:51:59+08:00">2015-09-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2015-09-29-Astar-algorithm/" class="post-meta-item leancloud_visitors" data-flag-title="学习A*寻路算法" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2015-09-29-Astar-algorithm/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2015-09-29-Astar-algorithm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="A-寻路"><a href="#A-寻路" class="headerlink" title="A*寻路"></a><code>A*</code>寻路</h1><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>我们日常生活中的很多决策问题都可以转化为对应的路径规划问题,如何从复杂的路径中寻找两个或者多个点之间的最短距离就是一个很值得研究的东西</p>
<p><code>A*</code>算法是一种寻路算法,解决的是路径规划问题的一种</p>
<p>目的是:</p>
<blockquote>
<p>找出某地图中两点之间的最短路径</p>
</blockquote>
<h2 id="寻路过程"><a href="#寻路过程" class="headerlink" title="寻路过程"></a>寻路过程</h2><p>先来看个地图</p>
<pre><code>s:起点   e:终点  #:障碍
| | | | | | | |          
| | | |#| | | |
| |s| |#| |e| |
| | | |#| | | |
| | | | | | | |</code></pre><p>现在有这样的需求,我们需要找出s-&gt;e的最短路径<br>但是,s和e之间有一堵’墙’,就是”#”啦<br>这样怎么才能找出最短路径呢?  </p>
<p>第一种做法(Dijkstra算法):</p>
<pre><code>s:起点   e:终点  *:检索路径 #:障碍
|*|*|*| | | | |
|*|*|*|#| | | |
|*|s|*|#| |e| |
|*|*|*|#|*|*| |
|*|*|*|*|*| | |</code></pre><p>或者我们可以这样做(A*):</p>
<pre><code>s:起点   e:终点 *:检索路径 #:障碍
| | | | | | | |       
|*|*|*|#| | | |
|*|s|*|#| |e| |
|*|*|*|#|*| | |
| | |*|*|*| | |</code></pre><p>很明显,第二种做法比第一种做法检索的路径要少很多,当然,速度上就要快一些,对一些更复杂的地图,<code>A*</code>要比普通广度优先的算法快上许多</p>
<p>例如:</p>
<pre><code>s:起点  e:终点  *:检索路径  #:障碍
| | | | | | | | | | | | | |    
| | | | | | | | |e| | | | |    
| | | |#|#|#|#|#|#|#| | | |    
| | |#| | | | | | | |#| | |    
| | |#| | | | | | | |#| | |    
| | |#| | | | | | | |#| | |    
| | |#| | | | | | | |#| | |    
| | | | | | | | | | | | | |
| | | | | | |s| | | | | | |
| | | | | | | | | | | | | |
| | | | | | | | | | | | | |</code></pre><p>这个地图中从s到e,如果使用普通寻路可能是这样的</p>
<pre><code>s:起点  e:终点  *:最终路径  #:障碍
| | | | | | | | | | | | | |    
| | | | | | | | |e|*|*| | |    
| | | |#|#|#|#|#|#|#|*|*| |    
| | |#| | | |*|*|*|*|#|*| |    
| | |#| | | |*| | |*|#|*| |    
| | |#| | | |*| | |*|#|*| |    
| | |#| | | |*| | |*|#|*| |    
| | | | | | |*| | | |*|*| |
| | | | | | |s| | | | | | |
| | | | | | | | | | | | | |
| | | | | | | | | | | | | |</code></pre><p>很明显,寻路过程中出现了较多的无用步数,寻路进入了布袋口里面,我们期望的是寻路尽量快速,寻找最短路径,<code>A*</code>的做法就比较符合我们的期望</p>
<p><code>A*</code>寻路:</p>
<pre><code>s:起点  e:终点  *:最终路径 #:障碍
| | | | | | | | | | | | | |    
| | | | | | | | |e|*|*| | |    
| | | |#|#|#|#|#|#|#|*|*| |    
| | |#| | | | | | | |#|*| |    
| | |#| | | | | | | |#|*| |    
| | |#| | | | | | | |#|*| |    
| | |#| | | | | | | |#|*| |    
| | | | | | |*|*|*|*|*|*| |
| | | | | | |s| | | | | | |
| | | | | | | | | | | | | |
| | | | | | | | | | | | | |</code></pre><h2 id="A-寻路的主要过程"><a href="#A-寻路的主要过程" class="headerlink" title="A*寻路的主要过程"></a><code>A*</code>寻路的主要过程</h2><ol>
<li>将起点S加入到开放列表(开放列表中的点都是可用的)</li>
<li>寻找起点S周围所有可到达的点,并计算F值(最终衡量陆静距离的值),设置这些点的父节点为起点,将这些点加入到一个开放列表</li>
<li>将起点从开放列表中删除,并添加到关闭列表,从开放列表中选取F值最小的点M(如果有多个最小F值,随机取其一)</li>
<li>将M从开放列表中删除,并添加到关闭列表,计算M周围可到达的点,重新计算F值,将周围这些点都存入开放列表,设置他们的父节点为M</li>
<li>如果M周围某个点已经在开放列表中,重新计算F值和G值(已消耗路径),选取新旧G值中最小的点</li>
<li>最后如果发现终点在开放列表中,终止程序</li>
</ol>
<p><strong><code>A*</code>寻路的精髓</strong></p>
<p>核心公式：<strong>F = G + H</strong></p>
<p>F:用来评价点距起点距离的值</p>
<p>G:实际已耗费的路径</p>
<p>H:未来还需要耗费的路径</p>
<p><code>A*</code>算法的实质是通过维护一个<code>待检测点的列表(open list)</code>和一个<code>已检测点的列表(closed list)</code>来记录寻路过程,从图形上来看，OPEN集是已访问区域的边界，CLOSED集是已访问区域的内部。每个节点还包含一个指向父节点的指针，以确定追踪关系。</p>
<p>算法有一个主循环,重复地从OPEN集中取最优节点n(即f值最小的节点)来检测.如果n是目标节点,那么算法结束;<br>否则,将节点n从OPEN集删除,并添加到CLOSED集中,然后查看n的所有邻节点n’,如果邻节点在CLOSED集,它已被检测过,则无需再检测;<br>如果邻节点在OPEN集,它将会被检测,则无需此时检测;<br>否则,将该邻节点加入OPEN集,设置其父节点为n,到n’的路径开销<code>F(n') = G(n) + H(n,n')</code></p>
<h2 id="A-的变种"><a href="#A-的变种" class="headerlink" title="A*的变种"></a><code>A*</code>的变种</h2><p><code>A*</code>算法可以通过<code>动态加权</code>,<code>跳跃点搜索</code>,<code>双向搜索</code>,<code>迭代深化</code>等进行性能和功能的优化</p>
<p>此外还有<code>动态A*</code>与<code>终身规划A*</code>等变化,这些变化其实都是基于基本的<code>A*</code>理论来进行优化</p>
<h2 id="寻路算法的应用"><a href="#寻路算法的应用" class="headerlink" title="寻路算法的应用"></a>寻路算法的应用</h2><p>比较常见的是寻路算法在游戏中的应用,因为很多游戏中会有地图的概念,涉及到地图就很容易有寻路规划的需要</p>
<p>比如:许多RPG游戏中会有去寻找某个NPC接任务或者去某个地方打败某个BOSS</p>
<p>寻路算法在生活中也有应用,比如 探索和侦查,道路建设,地形分析,城市规划等</p>
<p>总之,深入研究寻路算法是非常有意义的</p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p>如果有希望深入了解<code>A*</code>的读者,强烈推荐一篇文章,作者写的非常用心,讲的也特别细</p>
<p>地址:<a href="http://theory.stanford.edu/~amitp/GameProgramming/index.html" target="_blank" rel="noopener">http://theory.stanford.edu/~amitp/GameProgramming/index.html</a></p>
<h2 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h2><p>下面是一个Python实现的<code>A*寻路</code>的代码:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node_Elem</span>:</span></span><br><span class="line">    <span class="comment">#开放列表和关闭列表的元素类型，parent用来在成功的时候回溯路径</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent, x, y, dist)</span>:</span></span><br><span class="line">        self.parent = parent</span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        self.dist = dist</span><br></pre></td></tr></tbody></table></figure>

<p>主要程序</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A_Star</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#A星算法实现类</span></span><br><span class="line">    <span class="comment">#注意w,h两个参数，如果你修改了地图，需要传入一个正确值或者修改这里的默认参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, s_x, s_y, e_x, e_y, w=<span class="number">60</span>, h=<span class="number">30</span>)</span>:</span></span><br><span class="line">        self.s_x = s_x</span><br><span class="line">        self.s_y = s_y</span><br><span class="line">        self.e_x = e_x</span><br><span class="line">        self.e_y = e_y</span><br><span class="line"></span><br><span class="line">        self.width = w</span><br><span class="line">        self.height = h</span><br><span class="line"></span><br><span class="line">        self.open = []</span><br><span class="line">        self.close = []</span><br><span class="line">        self.path = []</span><br><span class="line"></span><br><span class="line">    <span class="comment">#查找路径的入口函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_path</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#构建开始节点</span></span><br><span class="line">        p = Node_Elem(<span class="literal">None</span>, self.s_x, self.s_y, <span class="number">0.0</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment">#扩展F值最小的节点</span></span><br><span class="line">            self.extend_round(p)</span><br><span class="line">            <span class="comment">#如果开放列表为空，则不存在路径，返回</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.open:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="comment">#获取F值最小的节点</span></span><br><span class="line">            idx, p = self.get_best()</span><br><span class="line">            <span class="comment">#找到路径，生成路径，返回</span></span><br><span class="line">            <span class="keyword">if</span> self.is_target(p):</span><br><span class="line">                self.make_path(p)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="comment">#把此节点压入关闭列表，并从开放列表里删除</span></span><br><span class="line">            self.close.append(p)</span><br><span class="line">            <span class="keyword">del</span> self.open[idx]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_path</span><span class="params">(self,p)</span>:</span></span><br><span class="line">        <span class="comment">#从结束点回溯到开始点，开始点的parent == None</span></span><br><span class="line">        <span class="keyword">while</span> p:</span><br><span class="line">            self.path.append((p.x, p.y))</span><br><span class="line">            p = p.parent</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_target</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> i.x == self.e_x <span class="keyword">and</span> i.y == self.e_y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_best</span><span class="params">(self)</span>:</span></span><br><span class="line">        best = <span class="literal">None</span></span><br><span class="line">        <span class="comment">#开放列表中最好的值</span></span><br><span class="line">        bv = self.width*self.height*<span class="number">10000</span> <span class="comment">#这个值应该大于地图的最大格子数量</span></span><br><span class="line">        <span class="comment">#开放列表中最好的键</span></span><br><span class="line">        bi = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> idx, i <span class="keyword">in</span> enumerate(self.open):</span><br><span class="line">            value = self.get_dist(i)<span class="comment">#获取F值</span></span><br><span class="line">            <span class="keyword">if</span> value &lt; bv:<span class="comment">#比以前的更好，即F值更小</span></span><br><span class="line">                best = i</span><br><span class="line">                bv = value</span><br><span class="line">                bi = idx</span><br><span class="line">        <span class="keyword">return</span> bi, best</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_dist</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="comment"># F = G + H</span></span><br><span class="line">        <span class="comment"># G 为已经走过的路径长度， H为估计还要走多远</span></span><br><span class="line">        <span class="comment"># 这个公式就是A*算法的精华了。</span></span><br><span class="line">        <span class="keyword">return</span> i.dist + math.sqrt((self.e_x-i.x)*(self.e_x-i.x)+ (self.e_y-i.y)*(self.e_y-i.y))*<span class="number">1.4</span><span class="comment">#这里的1.4为优化数字，可选范围[1.0-1.4],</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extend_round</span><span class="params">(self, p)</span>:</span></span><br><span class="line">        <span class="comment">#可以从8个方向走</span></span><br><span class="line">        xs = (<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        ys = (<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>,  <span class="number">0</span>, <span class="number">0</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">#只能走上下左右四个方向</span></span><br><span class="line">        <span class="comment">#xs = (0, -1, 1, 0)</span></span><br><span class="line">        <span class="comment">#ys = (-1, 0, 0, 1)</span></span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(xs, ys):</span><br><span class="line">            new_x, new_y = x + p.x, y + p.y</span><br><span class="line">            <span class="comment">#无效或者不可行走区域，则勿略</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.is_valid_coord(new_x, new_y):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment">#构造新的节点</span></span><br><span class="line">            node = Node_Elem(p, new_x, new_y, p.dist+self.get_cost(p.x, p.y, new_x, new_y))</span><br><span class="line">            <span class="comment">#新节点在关闭列表，则忽略</span></span><br><span class="line">            <span class="keyword">if</span> self.node_in_close(node):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            i = self.node_in_open(node)</span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">-1</span>:</span><br><span class="line">                <span class="comment">#新节点在开放列表</span></span><br><span class="line">                <span class="keyword">if</span> self.open[i].dist &gt; node.dist:</span><br><span class="line">                    <span class="comment">#现在的路径到比以前到这个节点的路径更好~</span></span><br><span class="line">                    <span class="comment">#则使用现在的路径</span></span><br><span class="line">                    self.open[i].parent = p</span><br><span class="line">                    self.open[i].dist = node.dist</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            self.open.append(node)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cost</span><span class="params">(self, x1, y1, x2, y2)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#上下左右直走，代价为1.0，斜走，代价为1.4</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> x1 == x2 <span class="keyword">or</span> y1 == y2:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.4</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">node_in_close</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.close:</span><br><span class="line">            <span class="keyword">if</span> node.x == i.x <span class="keyword">and</span> node.y == i.y:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">node_in_open</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i, n <span class="keyword">in</span> enumerate(self.open):</span><br><span class="line">            <span class="keyword">if</span> node.x == n.x <span class="keyword">and</span> node.y == n.y:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_valid_coord</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt;= self.width <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> y &gt;= self.height:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> test_map[y][x] != <span class="string">'#'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_searched</span><span class="params">(self)</span>:</span></span><br><span class="line">        l = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.open:</span><br><span class="line">            l.append((i.x, i.y))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.close:</span><br><span class="line">            l.append((i.x, i.y))</span><br><span class="line">        <span class="keyword">return</span> l</span><br></pre></td></tr></tbody></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2015-09-28-smallpt/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015-09-28-smallpt/" class="post-title-link" itemprop="url">学习smallpt全局光照引擎</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-28 18:51:59" itemprop="dateCreated datePublished" datetime="2015-09-28T18:51:59+08:00">2015-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2015-09-28-smallpt/" class="post-meta-item leancloud_visitors" data-flag-title="学习smallpt全局光照引擎" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2015-09-28-smallpt/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2015-09-28-smallpt/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="smallpt"><a href="#smallpt" class="headerlink" title="smallpt"></a>smallpt</h1><p>今天给大家介绍一个<strong>全局光照引擎</strong></p>
<p>该程序作者是<a href="http://www.kevinbeason.com/smallpt/" target="_blank" rel="noopener">kevinbeason</a></p>
<p>代码不长,只要<code>100</code>行左右,采用了<a href="http://baike.baidu.com/link?url=RQRnSUL-7NapJO695uvrH7FuHTXTB1tixzbM5tC65PS2gNjFhyTdpsrLCP-sBKSbhWWnwULdK3v3mEEjip7Caq" target="_blank" rel="noopener">Monte Carlo</a>算法</p>
<h1 id="图片效果"><a href="#图片效果" class="headerlink" title="图片效果"></a>图片效果</h1><p>渲染出来的图片最终效果</p>
<p><img data-src="https://i.loli.net/2020/05/09/CSk356LrHV7uJIB.png" alt="result_25k.png"></p>
<h1 id="代码动态演示"><a href="#代码动态演示" class="headerlink" title="代码动态演示"></a>代码动态演示</h1><p>展示区域就在下边这个<code>canvas</code>里面吧(注意:这个非常非常非常消耗性能,慎点)</p>
<p>该程序通过像素采样和作者设定好的对象数值进行渲染</p>
<p><strong>采样率越高,绘图质量越好,性能消耗越大</strong></p>
<p>实际采样率达到25000就已经是超级高的质量了,可惜性能…</p>
<p>在作者的网站里面还给出了其他集中场景的数值设定<a href="http://www.kevinbeason.com/smallpt/extraScenes.txt" target="_blank" rel="noopener">其他场景数值</a><br>可以通过修改参数渲染出不同的场景</p>
<div>设置采样率(实际值要*4):&nbsp;
<input type="number" min="0" max="10000000" step="25" value="25" id="samp" style="border:1px solid #ccc;padding:3px;border-radius:2px;">&nbsp;&nbsp;&nbsp;<button onclick="javascript:eval_render();" class="btn btn-info">Run</button>
</div>

<div style="text-align: center">
    <canvas id="renderCanvas" width="128" height="128" style="display:none"></canvas>
    <div id="status"></div>
</div>
源代码如下:

<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RandomLCG</span>(<span class="params">seed</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        seed = (<span class="number">214013</span> * seed + <span class="number">2531011</span>) % <span class="number">0x100000000</span>;</span><br><span class="line">        <span class="keyword">return</span> seed * (<span class="number">1.0</span> / <span class="number">4294967296.0</span>);</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vec</span>(<span class="params">x, y, z</span>) </span>{ <span class="keyword">this</span>.x = x; <span class="keyword">this</span>.y = y; <span class="keyword">this</span>.z = z; }</span><br><span class="line">Vec.prototype =</span><br><span class="line">{</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vec(<span class="keyword">this</span>.x + b.x, <span class="keyword">this</span>.y + b.y, <span class="keyword">this</span>.z + b.z);</span><br><span class="line">    },</span><br><span class="line">    sub: <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vec(<span class="keyword">this</span>.x - b.x, <span class="keyword">this</span>.y - b.y, <span class="keyword">this</span>.z - b.z);</span><br><span class="line">    },</span><br><span class="line">    mul: <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vec(<span class="keyword">this</span>.x * b, <span class="keyword">this</span>.y * b, <span class="keyword">this</span>.z * b);</span><br><span class="line">    },</span><br><span class="line">    mult: <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vec(<span class="keyword">this</span>.x * b.x, <span class="keyword">this</span>.y * b.y, <span class="keyword">this</span>.z * b.z);</span><br><span class="line">    },</span><br><span class="line">    norm: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.mul(<span class="number">1.0</span> / <span class="built_in">Math</span>.sqrt(<span class="keyword">this</span>.x * <span class="keyword">this</span>.x + <span class="keyword">this</span>.y * <span class="keyword">this</span>.y + <span class="keyword">this</span>.z * <span class="keyword">this</span>.z));</span><br><span class="line">    },</span><br><span class="line">    dot: <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.x * b.x + <span class="keyword">this</span>.y * b.y + <span class="keyword">this</span>.z * b.z;</span><br><span class="line">    },</span><br><span class="line">    cross: <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vec(<span class="keyword">this</span>.y * b.z - <span class="keyword">this</span>.z * b.y, <span class="keyword">this</span>.z * b.x - <span class="keyword">this</span>.x * b.z, <span class="keyword">this</span>.x * b.y - <span class="keyword">this</span>.y * b.x);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line">Vec.Zero = <span class="keyword">new</span> Vec(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">Vec.XAxis = <span class="keyword">new</span> Vec(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">Vec.YAxis = <span class="keyword">new</span> Vec(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">Vec.ZAxis = <span class="keyword">new</span> Vec(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">Refl = {<span class="attr">DIFF</span>: <span class="number">0</span>,<span class="attr">SPEC</span>: <span class="number">1</span>,<span class="attr">REFR</span>: <span class="number">2</span>};</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Ray</span>(<span class="params">o, d</span>) </span>{ <span class="keyword">this</span>.o = o; <span class="keyword">this</span>.d = d }</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sphere</span>(<span class="params">rad, p, e, c, refl</span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.rad = rad;</span><br><span class="line">    <span class="keyword">this</span>.p = p;</span><br><span class="line">    <span class="keyword">this</span>.e = e;</span><br><span class="line">    <span class="keyword">this</span>.c = c;</span><br><span class="line">    <span class="keyword">this</span>.refl = refl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.sqRad = rad * rad;</span><br><span class="line">    <span class="keyword">this</span>.maxC = <span class="built_in">Math</span>.max(<span class="built_in">Math</span>.max(c.x, c.y), c.z);</span><br><span class="line">    <span class="keyword">this</span>.cc = c.mul(<span class="number">1.0</span> / <span class="keyword">this</span>.maxC);</span><br><span class="line">}</span><br><span class="line">Sphere.prototype =</span><br><span class="line">{</span><br><span class="line">    intersect: <span class="function"><span class="keyword">function</span>(<span class="params">r</span>) </span>{</span><br><span class="line">        <span class="comment">// Solve t^2*d.d + 2*t*(o-p).d + (o-p).(o-p)-R^2 = 0</span></span><br><span class="line">        <span class="keyword">var</span> op = <span class="keyword">this</span>.p.sub(r.o);</span><br><span class="line">        <span class="keyword">var</span> b = op.dot(r.d);</span><br><span class="line">        <span class="keyword">var</span> det = b * b - op.dot(op) + <span class="keyword">this</span>.sqRad;</span><br><span class="line">        <span class="keyword">var</span> eps = <span class="number">1e-4</span>;</span><br><span class="line">        <span class="keyword">if</span> (det &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">var</span> dets = <span class="built_in">Math</span>.sqrt(det)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (b - dets &gt; eps)</span><br><span class="line">                <span class="keyword">return</span> b - dets;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (b + dets &gt; eps)</span><br><span class="line">                <span class="keyword">return</span> b + dets;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"><span class="comment">// Scene: radius, position, emission, color, material</span></span><br><span class="line">spheres = [</span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">1e5</span>, <span class="keyword">new</span> Vec(<span class="number">1e5</span> + <span class="number">1</span>, <span class="number">40.8</span>, <span class="number">81.6</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">.75</span>, <span class="number">.25</span>, <span class="number">.25</span>), Refl.DIFF), <span class="comment">//Left</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">1e5</span>, <span class="keyword">new</span> Vec(<span class="number">-1e5</span> + <span class="number">99</span>, <span class="number">40.8</span>, <span class="number">81.6</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">.25</span>, <span class="number">.25</span>, <span class="number">.75</span>), Refl.DIFF), <span class="comment">//Rght</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">1e5</span>, <span class="keyword">new</span> Vec(<span class="number">50</span>, <span class="number">40.8</span>, <span class="number">1e5</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">.75</span>, <span class="number">.75</span>, <span class="number">.75</span>), Refl.DIFF), <span class="comment">//Back</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">1e5</span>, <span class="keyword">new</span> Vec(<span class="number">50</span>, <span class="number">40.8</span>, <span class="number">-1e5</span> + <span class="number">170</span>), Vec.Zero, Vec.Zero, Refl.DIFF), <span class="comment">//Frnt</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">1e5</span>, <span class="keyword">new</span> Vec(<span class="number">50</span>, <span class="number">1e5</span>, <span class="number">81.6</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">.75</span>, <span class="number">.75</span>, <span class="number">.75</span>), Refl.DIFF), <span class="comment">//Botm</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">1e5</span>, <span class="keyword">new</span> Vec(<span class="number">50</span>, <span class="number">-1e5</span> + <span class="number">81.6</span>, <span class="number">81.6</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">.75</span>, <span class="number">.75</span>, <span class="number">.75</span>), Refl.DIFF), <span class="comment">//Top</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">16.5</span>, <span class="keyword">new</span> Vec(<span class="number">27</span>, <span class="number">16.5</span>, <span class="number">47</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>).mul(<span class="number">.999</span>), Refl.SPEC), <span class="comment">//Mirr</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">16.5</span>, <span class="keyword">new</span> Vec(<span class="number">73</span>, <span class="number">16.5</span>, <span class="number">78</span>), Vec.Zero, <span class="keyword">new</span> Vec(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>).mul(<span class="number">.999</span>), Refl.REFR), <span class="comment">//Glas</span></span><br><span class="line">    <span class="keyword">new</span> Sphere(<span class="number">600</span>, <span class="keyword">new</span> Vec(<span class="number">50</span>, <span class="number">681.6</span> - <span class="number">.27</span>, <span class="number">81.6</span>), <span class="keyword">new</span> Vec(<span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>), Vec.Zero, Refl.DIFF)  <span class="comment">//Lite</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rand = RandomLCG(<span class="number">0</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clamp</span>(<span class="params">x</span>) </span>{</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toInt</span>(<span class="params">x</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.pow(clamp(x), <span class="number">1</span> / <span class="number">2.2</span>) * <span class="number">255</span> + <span class="number">.5</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">intersect</span>(<span class="params">r</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> t = <span class="number">1e20</span>;</span><br><span class="line">    <span class="keyword">var</span> obj;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> spheres) {</span><br><span class="line">        <span class="keyword">var</span> s = spheres[i];</span><br><span class="line">        <span class="keyword">var</span> d = s.intersect(r);</span><br><span class="line">        <span class="keyword">if</span> (d != <span class="number">0</span> &amp;&amp; d &lt; t) {</span><br><span class="line">            t = d;</span><br><span class="line">            obj = s;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> [obj, t];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">radiance</span>(<span class="params">r, depth</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> ires = intersect(r);</span><br><span class="line">    <span class="keyword">var</span> obj = ires[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> t = ires[<span class="number">1</span>];   <span class="comment">// distance to intersection</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> Vec.Zero;       <span class="comment">// if miss, return black</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">var</span> newDepth = depth + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> isMaxDepth = newDepth &gt; <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Russian roulette for path termination</span></span><br><span class="line">        <span class="keyword">var</span> isUseRR = newDepth &gt; <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">var</span> isRR = isUseRR &amp;&amp; rand() &lt; obj.maxC;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isMaxDepth || (isUseRR &amp;&amp; !isRR))</span><br><span class="line">            <span class="keyword">return</span> obj.e;</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">var</span> f = (isUseRR &amp;&amp; isRR) ? obj.cc : obj.c;</span><br><span class="line">            <span class="keyword">var</span> x = r.o.add(r.d.mul(t));</span><br><span class="line">            <span class="keyword">var</span> n = x.sub(obj.p).norm();</span><br><span class="line">            <span class="keyword">var</span> nl = n.dot(r.d) &lt; <span class="number">0</span> ? n : n.mul(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (obj.refl == Refl.DIFF) <span class="comment">// Ideal DIFFUSE reflection</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> r1 = <span class="number">2</span> * <span class="built_in">Math</span>.PI * rand();</span><br><span class="line">                <span class="keyword">var</span> r2 = rand();</span><br><span class="line">                <span class="keyword">var</span> r2s = <span class="built_in">Math</span>.sqrt(r2);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> w = nl;</span><br><span class="line">                <span class="keyword">var</span> wo = <span class="built_in">Math</span>.abs(w.x) &gt; <span class="number">.1</span> ? <span class="keyword">new</span> Vec(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>) : <span class="keyword">new</span> Vec(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">var</span> u = wo.cross(w).norm();</span><br><span class="line">                <span class="keyword">var</span> v = w.cross(u);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> d = (u.mul(<span class="built_in">Math</span>.cos(r1) * r2s).add(v.mul(<span class="built_in">Math</span>.sin(r1) * r2s)).add(w.mul(<span class="built_in">Math</span>.sqrt(<span class="number">1</span> - r2)))).norm();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> obj.e.add(f.mult(radiance(<span class="keyword">new</span> Ray(x, d), newDepth)));</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (obj.refl == Refl.SPEC) <span class="comment">// Ideal SPECULAR reflection</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">return</span> obj.e.add(f.mult(radiance(<span class="keyword">new</span> Ray(x, r.d.sub(n.mul(<span class="number">2</span> * n.dot(r.d)))), newDepth)));</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="comment">// Ideal dielectric REFRACTION</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> reflRay = <span class="keyword">new</span> Ray(x, r.d.sub(n.mul(<span class="number">2</span> * n.dot(r.d))));</span><br><span class="line">                <span class="keyword">var</span> into = n.dot(nl) &gt; <span class="number">0</span>; <span class="comment">// var from outside going in?</span></span><br><span class="line">                <span class="keyword">var</span> nc = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">var</span> nt = <span class="number">1.5</span>;</span><br><span class="line">                <span class="keyword">var</span> nnt = into ? nc / nt : nt / nc;</span><br><span class="line">                <span class="keyword">var</span> ddn = r.d.dot(nl);</span><br><span class="line">                <span class="keyword">var</span> cos2t = <span class="number">1</span> - nnt * nnt * (<span class="number">1</span> - ddn * ddn);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (cos2t &lt; <span class="number">0</span>)  <span class="comment">// Total internal reflection</span></span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">return</span> obj.e.add(f.mult(radiance(reflRay, newDepth)));</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">var</span> tdir = (r.d.mul(nnt).sub(n.mul((into ? <span class="number">1</span> : <span class="number">-1</span>) * (ddn * nnt + <span class="built_in">Math</span>.sqrt(cos2t))))).norm();</span><br><span class="line">                    <span class="keyword">var</span> a = nt - nc;</span><br><span class="line">                    <span class="keyword">var</span> b = nt + nc;</span><br><span class="line">                    <span class="keyword">var</span> R0 = a * a / (b * b);</span><br><span class="line">                    <span class="keyword">var</span> c = <span class="number">1</span> - (into ? -ddn : tdir.dot(n));</span><br><span class="line">                    <span class="keyword">var</span> Re = R0 + (<span class="number">1</span> - R0) * c * c * c * c * c;</span><br><span class="line">                    <span class="keyword">var</span> Tr = <span class="number">1</span> - Re;</span><br><span class="line">                    <span class="keyword">var</span> P = <span class="number">.25</span> + <span class="number">.5</span> * Re;</span><br><span class="line">                    <span class="keyword">var</span> RP = Re / P;</span><br><span class="line">                    <span class="keyword">var</span> TP = Tr / (<span class="number">1</span> - P);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> result;</span><br><span class="line">                    <span class="keyword">if</span> (newDepth &gt; <span class="number">2</span>) {</span><br><span class="line">                        <span class="comment">// Russian roulette and splitting for selecting reflection and/or refraction</span></span><br><span class="line">                        <span class="keyword">if</span> (rand() &lt; P)</span><br><span class="line">                            result = radiance(reflRay, newDepth).mul(RP);</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            result = radiance(<span class="keyword">new</span> Ray(x, tdir), newDepth).mul(TP);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        result = radiance(reflRay, newDepth).mul(Re).add(radiance(<span class="keyword">new</span> Ray(x, tdir), newDepth).mul(Tr));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> obj.e.add(f.mult(result));</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">canvas, status</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">var</span> w = canvas.attributes.width.value;</span><br><span class="line">    <span class="keyword">var</span> h = canvas.attributes.height.value;</span><br><span class="line">    <span class="keyword">var</span> samps = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cam pos, dir</span></span><br><span class="line">    <span class="keyword">var</span> cam = <span class="keyword">new</span> Ray(<span class="keyword">new</span> Vec(<span class="number">50</span>, <span class="number">52</span>, <span class="number">295.6</span>), <span class="keyword">new</span> Vec(<span class="number">0</span>, <span class="number">-0.042612</span>, <span class="number">-1</span>).norm());</span><br><span class="line">    <span class="keyword">var</span> cx = <span class="keyword">new</span> Vec(w * <span class="number">.5135</span> / h, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">var</span> cy = (cx.cross(cam.d)).norm().mul(<span class="number">.5135</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// final color buffer</span></span><br><span class="line">    <span class="keyword">var</span> c = <span class="keyword">new</span> <span class="built_in">Array</span>(w * h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; w * h; i++)</span><br><span class="line">        c[i] = Vec.Zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output</span></span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">    <span class="keyword">var</span> imgdata = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">    <span class="keyword">var</span> pixels = imgdata.data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Loop over image rows</span></span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">0</span>;</span><br><span class="line">    setTimeout(renderLine, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">renderLine</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        status.innerHTML = <span class="string">"Rendering ("</span> + samps * <span class="number">4</span> + <span class="string">" spp) "</span> + (<span class="number">100.0</span> * y / (h - <span class="number">1</span>)).toFixed(<span class="number">2</span>) + <span class="string">"%"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Loop cols</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; w; x++) {</span><br><span class="line">            <span class="comment">// 2x2 subpixel rows</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> sy = <span class="number">0</span>; sy &lt; <span class="number">2</span>; sy++) {</span><br><span class="line">                <span class="keyword">var</span> i = (h - y - <span class="number">1</span>) * w + x;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 2x2 subpixel cols</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> sx = <span class="number">0</span>; sx &lt; <span class="number">2</span>; sx++) {</span><br><span class="line">                    <span class="keyword">var</span> r = Vec.Zero;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> s = <span class="number">0</span>; s &lt; samps; s++) {</span><br><span class="line">                        <span class="keyword">var</span> r1 = <span class="number">2</span> * rand();</span><br><span class="line">                        <span class="keyword">var</span> r2 = <span class="number">2</span> * rand();</span><br><span class="line">                        <span class="keyword">var</span> dx = r1 &lt; <span class="number">1</span> ? <span class="built_in">Math</span>.sqrt(r1) - <span class="number">1</span> : <span class="number">1</span> - <span class="built_in">Math</span>.sqrt(<span class="number">2</span> - r1);</span><br><span class="line">                        <span class="keyword">var</span> dy = r2 &lt; <span class="number">1</span> ? <span class="built_in">Math</span>.sqrt(r2) - <span class="number">1</span> : <span class="number">1</span> - <span class="built_in">Math</span>.sqrt(<span class="number">2</span> - r2);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">var</span> d = cx.mul(((sx + <span class="number">.5</span> + dx) / <span class="number">2</span> + x) / w - <span class="number">.5</span>).add(</span><br><span class="line">                        cy.mul(((sy + <span class="number">.5</span> + dy) / <span class="number">2</span> + y) / h - <span class="number">.5</span>)).add(cam.d);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Camera rays are pushed forward to start in interior</span></span><br><span class="line">                        <span class="keyword">var</span> camRay = <span class="keyword">new</span> Ray(cam.o.add(d.mul(<span class="number">140</span>)), d.norm());</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Accumuate radiance</span></span><br><span class="line">                        r = r.add(radiance(camRay, <span class="number">0</span>).mul(<span class="number">1.0</span> / samps));</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Convert radiance to color</span></span><br><span class="line">                    c[i] = c[i].add((<span class="keyword">new</span> Vec(clamp(r.x), clamp(r.y), clamp(r.z))).mul(<span class="number">.25</span>));</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        renderOutput();</span><br><span class="line"></span><br><span class="line">        y++;</span><br><span class="line">        <span class="keyword">if</span> (y &lt; h)</span><br><span class="line">            setTimeout(renderLine, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            status.innerHTML = (<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - start) / <span class="number">1000</span> + <span class="string">" sec"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">renderOutput</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">var</span> i = (h - y - <span class="number">1</span>) * w * <span class="number">4</span>, j = (h - y - <span class="number">1</span>) * w;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; w; x++) {</span><br><span class="line">            pixels[i++] = toInt(c[j].x);</span><br><span class="line">            pixels[i++] = toInt(c[j].y);</span><br><span class="line">            pixels[i++] = toInt(c[j].z);</span><br><span class="line">            pixels[i++] = <span class="number">255</span>;</span><br><span class="line">            j++;</span><br><span class="line">        }</span><br><span class="line">        ctx.putImageData(imgdata, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<script>
function RandomLCG(seed) {
    return function() {
        seed = (214013 * seed + 2531011) % 0x100000000;
        return seed * (1.0 / 4294967296.0);
    };
}

function Vec(x, y, z) {
    this.x = x;
    this.y = y;
    this.z = z;
}

Vec.prototype = {
    add: function(b) {
        return new Vec(this.x + b.x, this.y + b.y, this.z + b.z);
    },

    sub: function(b) {
        return new Vec(this.x - b.x, this.y - b.y, this.z - b.z);
    },

    mul: function(b) {
        return new Vec(this.x * b, this.y * b, this.z * b);
    },

    mult: function(b) {
        return new Vec(this.x * b.x, this.y * b.y, this.z * b.z);
    },

    norm: function() {
        return this.mul(1.0 / Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z));
    },

    dot: function(b) {
        return this.x * b.x + this.y * b.y + this.z * b.z;
    },

    cross: function(b) {
        return new Vec(this.y * b.z - this.z * b.y, this.z * b.x - this.x * b.z, this.x * b.y - this.y * b.x);
    }
};

Vec.Zero = new Vec(0, 0, 0)
Vec.XAxis = new Vec(1, 0, 0)
Vec.YAxis = new Vec(0, 1, 0)
Vec.ZAxis = new Vec(0, 0, 1)

Refl = {
    DIFF: 0,
    SPEC: 1,
    REFR: 2
};

function Ray(o, d) {
    this.o = o;
    this.d = d
}

function Sphere(rad, p, e, c, refl) {
    this.rad = rad;
    this.p = p;
    this.e = e;
    this.c = c;
    this.refl = refl;

    this.sqRad = rad * rad;
    this.maxC = Math.max(Math.max(c.x, c.y), c.z);
    this.cc = c.mul(1.0 / this.maxC);
}

Sphere.prototype = {
    intersect: function(r) {
        var op = this.p.sub(r.o);
        var b = op.dot(r.d);
        var det = b * b - op.dot(op) + this.sqRad;
        var eps = 1e-4;

        if (det < 0)
            return 0;
        else {
            var dets = Math.sqrt(det)

            if (b - dets > eps) {
                return b - dets;
            } else if (b + dets > eps) {
                return b + dets;
            } else {
                return 0;
            }
        }
    }
};

spheres = [
    new Sphere(1e5, new Vec(1e5 + 1, 40.8, 81.6), Vec.Zero, new Vec(.75, .25, .25), Refl.DIFF),
    new Sphere(1e5, new Vec(-1e5 + 99, 40.8, 81.6), Vec.Zero, new Vec(.25, .25, .75), Refl.DIFF),
    new Sphere(1e5, new Vec(50, 40.8, 1e5), Vec.Zero, new Vec(.75, .75, .75), Refl.DIFF),
    new Sphere(1e5, new Vec(50, 40.8, -1e5 + 170), Vec.Zero, Vec.Zero, Refl.DIFF),
    new Sphere(1e5, new Vec(50, 1e5, 81.6), Vec.Zero, new Vec(.75, .75, .75), Refl.DIFF),
    new Sphere(1e5, new Vec(50, -1e5 + 81.6, 81.6), Vec.Zero, new Vec(.75, .75, .75), Refl.DIFF),
    new Sphere(16.5, new Vec(27, 16.5, 47), Vec.Zero, new Vec(1, 1, 1).mul(.999), Refl.SPEC),
    new Sphere(16.5, new Vec(73, 16.5, 78), Vec.Zero, new Vec(1, 1, 1).mul(.999), Refl.REFR),
    new Sphere(600, new Vec(50, 681.6 - .27, 81.6), new Vec(12, 12, 12), Vec.Zero, Refl.DIFF)
];

var rand = RandomLCG(0)

function clamp(x) {
    if (x < 0) {
        return 0;
    } else if (x > 1) {
        return 1;
    } else {
        return x;
    }
}

function toInt(x) {
    return Math.pow(clamp(x), 1 / 2.2) * 255 + .5
}

function intersect(r) {
    var t = 1e20;
    var obj;

    for (var i in spheres) {
        var s = spheres[i];
        var d = s.intersect(r);
        if (d != 0 && d < t) {
            t = d;
            obj = s;
        }
    }
    return [obj, t];
}

function radiance(r, depth) {
    var ires = intersect(r);
    var obj = ires[0];
    var t = ires[1];

    if (obj == null) {
        return Vec.Zero;
    } else {
        var newDepth = depth + 1;
        var isMaxDepth = newDepth > 100;

        var isUseRR = newDepth > 5;
        var isRR = isUseRR && rand() < obj.maxC;

        if (isMaxDepth || (isUseRR && !isRR)) {
            return obj.e;
        } else {
            var f = (isUseRR && isRR) ? obj.cc : obj.c;
            var x = r.o.add(r.d.mul(t));
            var n = x.sub(obj.p).norm();
            var nl = n.dot(r.d) < 0 ? n : n.mul(-1);

            if (obj.refl == Refl.DIFF) {
                var r1 = 2 * Math.PI * rand();
                var r2 = rand();
                var r2s = Math.sqrt(r2);

                var w = nl;
                var wo = Math.abs(w.x) > .1 ? new Vec(0, 1, 0) : new Vec(1, 0, 0);
                var u = wo.cross(w).norm();
                var v = w.cross(u);

                var d = (u.mul(Math.cos(r1) * r2s).add(v.mul(Math.sin(r1) * r2s)).add(w.mul(Math.sqrt(1 - r2)))).norm();

                return obj.e.add(f.mult(radiance(new Ray(x, d), newDepth)));
            } else if (obj.refl == Refl.SPEC) {
                return obj.e.add(f.mult(radiance(new Ray(x, r.d.sub(n.mul(2 * n.dot(r.d)))), newDepth)));
            } else {
                var reflRay = new Ray(x, r.d.sub(n.mul(2 * n.dot(r.d))));
                var into = n.dot(nl) > 0;
                var nc = 1;
                var nt = 1.5;
                var nnt = into ? nc / nt : nt / nc;
                var ddn = r.d.dot(nl);
                var cos2t = 1 - nnt * nnt * (1 - ddn * ddn);

                if (cos2t < 0) {
                    return obj.e.add(f.mult(radiance(reflRay, newDepth)));
                } else {
                    var tdir = (r.d.mul(nnt).sub(n.mul((into ? 1 : -1) * (ddn * nnt + Math.sqrt(cos2t))))).norm();
                    var a = nt - nc;
                    var b = nt + nc;
                    var R0 = a * a / (b * b);
                    var c = 1 - (into ? -ddn : tdir.dot(n));
                    var Re = R0 + (1 - R0) * c * c * c * c * c;
                    var Tr = 1 - Re;
                    var P = .25 + .5 * Re;
                    var RP = Re / P;
                    var TP = Tr / (1 - P);

                    var result;
                    if (newDepth > 2) {

                        if (rand() < P) {
                            result = radiance(reflRay, newDepth).mul(RP);
                        } else {
                            result = radiance(new Ray(x, tdir), newDepth).mul(TP);
                        }
                    } else {
                        result = radiance(reflRay, newDepth).mul(Re).add(radiance(new Ray(x, tdir), newDepth).mul(Tr));
                    }

                    return obj.e.add(f.mult(result));
                }
            }
        }
    }
}

function render(canvas, status) {
    var start = new Date().getTime();
    var w = canvas.attributes.width.value;
    var h = canvas.attributes.height.value;
    var samps = 25;

    var samps = document.getElementById("samp").value;

    var cam = new Ray(new Vec(50, 52, 295.6), new Vec(0, -0.042612, -1).norm());
    var cx = new Vec(w * .5135 / h, 0, 0);
    var cy = (cx.cross(cam.d)).norm().mul(.5135);
    var c = new Array(w * h);
    for (var i = 0; i < w * h; i++)
        c[i] = Vec.Zero;

    var ctx = canvas.getContext("2d");
    var imgdata = ctx.getImageData(0, 0, w, h);
    var pixels = imgdata.data;

    var y = 0;
    setTimeout(renderLine, 0);

    function renderLine() {
        status.innerHTML = "Rendering (" + samps * 4 + " spp) " + (100.0 * y / (h - 1)).toFixed(2) + "%";

        for (var x = 0; x < w; x++) {
            for (var sy = 0; sy < 2; sy++) {
                var i = (h - y - 1) * w + x;

                for (var sx = 0; sx < 2; sx++) {
                    var r = Vec.Zero;
                    for (var s = 0; s < samps; s++) {
                        var r1 = 2 * rand();
                        var r2 = 2 * rand();
                        var dx = r1 < 1 ? Math.sqrt(r1) - 1 : 1 - Math.sqrt(2 - r1);
                        var dy = r2 < 1 ? Math.sqrt(r2) - 1 : 1 - Math.sqrt(2 - r2);

                        var d = cx.mul(((sx + .5 + dx) / 2 + x) / w - .5).add(
                            cy.mul(((sy + .5 + dy) / 2 + y) / h - .5)).add(cam.d);

                        var camRay = new Ray(cam.o.add(d.mul(140)), d.norm());

                        r = r.add(radiance(camRay, 0).mul(1.0 / samps));
                    }

                    c[i] = c[i].add((new Vec(clamp(r.x), clamp(r.y), clamp(r.z))).mul(.25));
                }
            }
        }

        renderOutput();

        y++;
        if (y < h) {
            setTimeout(renderLine, 0);
        } else {
            status.innerHTML = (new Date().getTime() - start) / 1000 + " sec";
        }
    }

    function renderOutput() {
        var i = (h - y - 1) * w * 4,
            j = (h - y - 1) * w;
        for (var x = 0; x < w; x++) {
            pixels[i++] = toInt(c[j].x);
            pixels[i++] = toInt(c[j].y);
            pixels[i++] = toInt(c[j].z);
            pixels[i++] = 255;
            j++;
        }

        ctx.putImageData(imgdata, 0, 0);
    }
}

function eval_render()
{
    var canvas = document.getElementById("renderCanvas");
    var status = document.getElementById("status");
    canvas.style.display="block";
    render(canvas,status);
}
</script>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2015-09-27-simple-raytracing/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015-09-27-simple-raytracing/" class="post-title-link" itemprop="url">一个简单的用JS实现的光线追踪效果</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-27 18:51:00" itemprop="dateCreated datePublished" datetime="2015-09-27T18:51:00+08:00">2015-09-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">计算机编程</span></a>
                </span>
            </span>

          
            <span id="/2015-09-27-simple-raytracing/" class="post-meta-item leancloud_visitors" data-flag-title="一个简单的用JS实现的光线追踪效果" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2015-09-27-simple-raytracing/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2015-09-27-simple-raytracing/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          一个简单的js光线追踪实现.
          <!--noindex-->
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2015-09-18-do-not-afraid/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015-09-18-do-not-afraid/" class="post-title-link" itemprop="url">别害怕</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-18 00:00:00" itemprop="dateCreated datePublished" datetime="2015-09-18T00:00:00+08:00">2015-09-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%87%E5%8C%96%E8%89%BA%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">文化艺术</span></a>
                </span>
            </span>

          
            <span id="/2015-09-18-do-not-afraid/" class="post-meta-item leancloud_visitors" data-flag-title="别害怕" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2015-09-18-do-not-afraid/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2015-09-18-do-not-afraid/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>别害怕</strong></p>
<p>上天很公平</p>
<p>你选择什么，就必定要放弃什么</p>
<p>你得到什么，就必定要舍弃什么</p>
<p>人生的道路上</p>
<p>若要前行，就必须要离开现在停留的地方</p>
<p>若要挥别过去，就必须拥有涅磐重生的勇气</p>
<p>就算爱情欺骗了我们</p>
<p>这并非我们绝望的原因</p>
<p>我们还有很多热情</p>
<p>给分开，给荡漾，给爱人，给安寂</p>
<p>就算过去刺痛了我们</p>
<p>这并非是我们逃避的原因</p>
<p>我们依然有很多憧憬</p>
<p>对梦想，对记忆，对失败，对希冀</p>
<p>就算现实撕裂了我们</p>
<p>这并非是我们茫然的原因</p>
<p>我们依然有很多完整</p>
<p>至少我可以成全我自己</p>
<p>不管什么时候 不管身处何地</p>
<p>只要我们还在期待 只要我们还会感觉到寂寞</p>
<p>只要我们还心怀着荡漾 只要我们没有放弃自己</p>
<p>那么我们就没有老去</p>
<p>那么我们至少还拥有青春</p>
<p>四时可爱唯春色 一事能痴便少年</p>
<p>趁着千载难逢的机会</p>
<p>去抛弃那些你想要放弃却不敢忘记的过往</p>
<p>去尝试那些你想要尝试而没有做的转变</p>
<p>去迎接那些你虽然忐忑却注定美丽的未来</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leriou.github.io/2015-06-01-simple-git-operation/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="哎呀是太阳嘛">
      <meta itemprop="description" content="君子生非异也, 善假于物也">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leriou's Tavern">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015-06-01-simple-git-operation/" class="post-title-link" itemprop="url">git简单使用指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2015-06-01T00:00:00+08:00">2015-06-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">编程工具</span></a>
                </span>
            </span>

          
            <span id="/2015-06-01-simple-git-operation/" class="post-meta-item leancloud_visitors" data-flag-title="git简单使用指南" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2015-06-01-simple-git-operation/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2015-06-01-simple-git-operation/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="git操作基础"><a href="#git操作基础" class="headerlink" title="git操作基础"></a>git操作基础</h2><p>推荐一个git官方的GUI客户端:<a href="https://desktop.github.com/" target="_blank" rel="noopener">https://desktop.github.com/</a></p>
<h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><p><img data-src="https://i.loli.net/2020/05/09/QMgToH8ti9CSzVw.png" alt="git-process.png"></p>
<p>git基本命令格式</p>
<pre><code>git 命令 参数</code></pre><p>部分名词解释:</p>
<pre><code>origin: 本地代码库  (可以自己设置)

remote: 远端代码库地址

head: 版本指针

branch: 分支</code></pre><p>Git的相关配置有两份一份在项目中的<code>.git</code>文件价中</p>
<p>一份全局的位于用户目录下的<code>.git</code>目录中</p>
<p>项目配置优先于全局配置, 会覆盖掉全局中的配置</p>
<h2 id="获取项目"><a href="#获取项目" class="headerlink" title="获取项目"></a>获取项目</h2><ol>
<li>新建仓库</li>
</ol>
<ul>
<li>对已存在的项目目录使用 <code>git init</code></li>
</ul>
<ol start="2">
<li>克隆仓库</li>
</ol>
<ul>
<li>https方式</li>
</ul>
<p>例如: <code>git clone  https://git.coding.net/gongchang/gc.buyer.git</code></p>
<p>该方式推送更新可能需要先设置用户名和密码</p>
<ul>
<li>ssh方式(推荐)</li>
</ul>
<p>例如:<code>git clone git@git.coding.net:gongchang/gc.buyer.git</code></p>
<p>该方式获取项目建议先生成ssh-key, 并将ssh-key添加到授权中(github/gitlab等设置中都有添加ssh-key的方法)</p>
<p>对应svn命令 : <code>svn clone XXXXXX</code></p>
<h3 id="生成ssh-key"><a href="#生成ssh-key" class="headerlink" title="生成ssh-key"></a>生成ssh-key</h3><p><code>ssh-keygen -t rsa -C "youremail@example.com"</code> </p>
<p>使用ssh生成ssh-key</p>
<p>生成的ssh-key位于用户目录下的.ssh目录中, 一共有两个一个公钥, 一个私钥</p>
<p>将<code>xxx.pub</code>中的公钥copy到git服务器中,再检查用户名和密码,就可以用ssh登录git了</p>
<ol start="3">
<li>获取更新</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master   //origin代表当前版本库,master是远端分支名,如果要更新dev分支就是 git pull origin dev </span><br><span class="line"></span><br><span class="line">或者简化版</span><br><span class="line"></span><br><span class="line">git pull  //这种方式有时候默认拉下来的不是master分支,需要自己手动切换一下</span><br></pre></td></tr></tbody></table></figure>
<p>此命令等同<code>git fetch</code>+ <code>git merge</code>, 对应svn命令:<code>svn update</code></p>
<h2 id="提交代码"><a href="#提交代码" class="headerlink" title="提交代码"></a>提交代码</h2><ol>
<li>暂存区</li>
</ol>
<p>修改完代码以后需要将修改添加到暂存区 </p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .                 //.代表当前目录</span><br><span class="line">如果要添加当前目录下的 1.txt文件,相应的命令就是</span><br><span class="line">git add 1.txt</span><br></pre></td></tr></tbody></table></figure>

<p>未添加到暂存区的修改可以用<code>git checkout</code> 撤销,对应svn命令 <code>svn revert -R .</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout .    //.代表当前目录</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>提交</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"测试提交"</span>  //<span class="string">"测试提交"</span>是对本次提交的描述</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>推送</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git push origin master   //origin 当前版本库  master远端分支名</span><br><span class="line"> </span><br><span class="line">git push origin dev      //往dev分支上推送代码</span><br></pre></td></tr></tbody></table></figure>

<p>下面三条命令 相当于 svn的一条命令  <code>svn commit -m "测试"</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"测试"</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></tbody></table></figure>
<h2 id="分支操作"><a href="#分支操作" class="headerlink" title="分支操作"></a>分支操作</h2><ol>
<li>查看当前分支, *号所在就是你当前分支<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></tbody></table></figure></li>
<li>新建分支</li>
</ol>
<p>新建分支dev_test,假设当前在dev分支</p>
<p>命令:<code>git checkout -b dev_test</code>或<code>git branch dev_test</code></p>
<p>对应svn命令 :<code>svn copy dev dev_test</code></p>
<ol start="3">
<li>切换分支</li>
</ol>
<p>命令:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev_test   //切换到dev_test分支</span><br></pre></td></tr></tbody></table></figure>
<ol start="3">
<li>合并dev_test到dev</li>
</ol>
<p>当前所在分支为dev,命令:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge origin/dev_test</span><br></pre></td></tr></tbody></table></figure>

<ol start="4">
<li>删除分支</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d dev_test</span><br></pre></td></tr></tbody></table></figure>

<h2 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h2><ol>
<li>处理冲突</li>
</ol>
<p>下面是冲突代码的显示形式,表明两个代码库此处代码不一致,需要手动解决冲突</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">test1</span><br><span class="line">=======</span><br><span class="line">test2</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>将代码手动修改为</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test2</span><br></pre></td></tr></tbody></table></figure>
<p>然后执行 1. <code>git add .</code> 2.<code>git commit -m "解决冲突"</code>    3.<code>git push origin master</code></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>查看日志   <code>git log</code> </li>
<li>查看状态   <code>git status</code></li>
<li>查看修改   <code>git diff</code></li>
<li><code>git log --pretty=oneline 文件名</code> 可以查看某文件的修改记录</li>
</ol>
<h2 id="高级操作"><a href="#高级操作" class="headerlink" title="高级操作"></a>高级操作</h2><ul>
<li>场景1: 如果觉得Git的提交记录太多太乱,想清理git的提交记录,变得整洁</li>
</ul>
<p><code>git rebase</code> </p>
<p>重新设定分支,十分少用,把当前提交定位到某次提交之后</p>
<ul>
<li>场景2: 有时候部分修改已经提交,但后来发现这个功能不用上线了,你当然可以手动切换一个新分支, 但是也可以使用另一个命令将当前分支设置为之前的某一个版本</li>
</ul>
<p><code>git reset</code></p>
<p>放弃所有未推送的提交</p>
<ul>
<li>场景3: 线上某个版本上线之后出了问题,需要紧急会退到上一个正常的版本</li>
</ul>
<p><code>git revert</code></p>
<p>版本回退,可用于撤销已推送的错误提交</p>
<p><em>ps: <code>git reset HEAD</code> 然后<code>git push -f</code>这样也能达到撤销错误提交的作用,但是如果在你错误提交之后,有同学进行了新提交,这个新提交也会被撤销</em></p>
<ul>
<li>场景4: 你正在A分支上面开发新功能,此时有个紧急bug需要你处理</li>
</ul>
<p>可以使用<code>git stash</code>暂存起来, 切换到其他分支上去开发功能, 开发完毕切换回来, 用 <code>git stash apply</code>恢复之前的修改</p>
<p><code>git stash list</code>:列出储藏列表</p>
<p><code>git stash drop</code>: 删除一个储藏</p>
<p><code>git stash apply stash@{2}</code>: 应用储藏</p>
<p><code>git stash pop</code>: 应用最新的一个储藏</p>
<p><code>git stash clear</code>: 清理所有储藏</p>
<p><code>git stash branch testchanges</code>: 从储藏中创建分支</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">…</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">哎呀是太阳嘛</p>
  <div class="site-description" itemprop="description">君子生非异也, 善假于物也</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/leriou" title="GitHub → https://github.com/leriou" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/1985364641" title="Weibo → https://weibo.com/1985364641" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/yange1876" title="Twitter → https://twitter.com/yange1876" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  © 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">哎呀是太阳嘛</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  
  














  




  














  

  






<script src="/bundle.js"></script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'd3Ferur4FUri7vERAylGpome-gzGzoHsz',
      appKey     : 'uRGeMnmfAq6h88QavSUfpS3q',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></body></html>